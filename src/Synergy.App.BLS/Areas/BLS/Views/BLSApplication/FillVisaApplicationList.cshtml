@inject Microsoft.Extensions.Configuration.IConfiguration configuration
@inject IStringLocalizer<Synergy.App.BLS.Areas.Controllers.BLSApplicationController> Resource
@using System.Text;
@using Synergy.App.ViewModel;
@using Synergy.App.Common;
@inject Microsoft.Extensions.Configuration.IConfiguration configuration
@using Microsoft.Extensions.Configuration

@model BLSVisaAppointmentViewModel

@{
    ViewData["Title"] = "Visa Application Details";
    Layout = "~/Areas/Core/Views/Shared/_PopupLayout.cshtml";
    //Layout = "~/Areas/Core/Views/Shared/Themes/Looper/_Layout.cshtml";
}

<style>
    
    .blsmain {
        margin: 25px;
        background-color: #F8F8F8;
        border-radius: 1rem;
        padding: 20px;
    }

    .avatar-myProfile {
        border-radius: 10%;
        height: 120px;
        width: 120px;
    }
    .form-label {
        color: #363642 !important;
    }
</style>

<script> 
        
    function FillVisaApplication(serId, fname, lname, email, dob, appstatus, conNumber) {
        debugger;
        btnId = serId;
        var portalId = '@ViewBag.PortalId';

        var udfs = encodeURIComponent('Surname=' + lname + '&FirstName=' + fname + '&ApplicantsEmailId=' + email + '&DateOfBirth=' + dob + '&ApplicationStatusId=' + appstatus + '&TelephoneNo=' + conNumber);
        var roudfs = encodeURIComponent('AppointmentId=true');

        var url = '/Cms/Page?lo=Popup&cbm=OnAfterService&pageType=Service&source=Edit&dataAction=Edit&templateCodes=BLS_VISA_SCHENGEN&portalId=' + portalId + '&udfs=' + udfs + '&roudfs=' + roudfs + '&recordId=' + serId;
        var win = GetMainWindow();
        win.iframeOpenUrl = url;
        win.OpenWindow({ Title: 'Fill Visa Application', Width: 1200, Height: 700 });
        return false;
    }

    function OnAfterService() {
        //$('#' + btnId).prop('disabled', true);
        ShowNotification("Application Saved Successfully", "success");
    }

    function OnClose() {        
        var win = GetMainWindow();
        win.CloseWindow();
        return false;
    }

</script>


<div id="appWrapper" class="wrapper">
    <div class="page">
        <div class="page-inner">
            <div class="row-12 pad-10">
                <br />
                
                <table class="table" id="fillApplication">
                    <thead>
                        <tr>
                            <th>First Name</th>
                            <th>Last Name </th>
                            <th>Date Of Birth </th>
                            <th>Passport No </th>
                            <th>Appointment Date Time </th>
                            <th>Action </th>
                        </tr>
                    </thead>
                    <tbody>
                        @for (var i = 0; i < ViewBag.VisaApplicationList.Count; i++)
                        {
                        <tr>
                            <td class="align-middle"> @ViewBag.VisaApplicationList[i].FirstName </td>
                            <td class="align-middle"> @ViewBag.VisaApplicationList[i].LastName </td>
                            <td class="align-middle"> @ViewBag.VisaApplicationList[i].DateOfBirthT </td>
                            <td class="align-middle"> @ViewBag.VisaApplicationList[i].PassportNo </td>
                            <td class="align-middle"> @ViewBag.VisaApplicationList[i].AppointmentSlot </td>
                            @if (ViewBag.VisaApplicationList[i].ApplicationStatusCode == "BLS_APPLICATION_DRAFTED")
                            {
                                <td class="align-middle"> <button class="btn btn-primary" id="@ViewBag.VisaApplicationList[i].ApplicationServiceId" onclick="FillVisaApplication('@ViewBag.VisaApplicationList[i].ApplicationServiceId','@ViewBag.VisaApplicationList[i].FirstName','@ViewBag.VisaApplicationList[i].LastName','@ViewBag.VisaApplicationList[i].ApplicantEmail','@ViewBag.VisaApplicationList[i].DateOfBirth','@ViewBag.ApplicationStatus','@ViewBag.VisaApplicationList[i].CurrentContactNumber');">Fill Application</button> </td>
                            }
                        </tr>
                        }
                    </tbody>
                </table>
            </div>

            <div class="row" style="padding:10px">
                <div class="col-12 pad-10" style="text-align:center">
                    <button type="button" class="btn btn-secondary" onclick="OnClose();">@Resource["Close"]</button>
                    
                </div>
            </div>  
            
            @Html.HiddenFor(x => x.ServiceId)

        </div>
    </div>
</div>




