@{
    ViewData["Title"] = "Item Shelf";

}
@using Synergy.App.ViewModel;
@using Synergy.App.Common;
@using Newtonsoft.Json;
@model ItemShelfViewModel
@*<script src="~/js/IMS/InventoryManagement/Vendor.js" asp-append-version="true"></script>*@

<div class="row pad-10 no-gutters page-content">
    <div class="container" style="padding:0px;max-width:100%;">
        <ul class="nav nav-tabs" role="tablist" id="myTabs">
            <li class="nav-item"><a data-toggle="tab" href="#draft" class="nav-link active" role="tab" aria-controls="draft" aria-selected="true"><i class="far fa-file-alt" style="margin-left:15px;"></i><br />ITEM SHELF</a></li>
            <li class="nav-item disabled" id="categoryTab" ><a data-toggle="tab" href="#categoryPage" class="nav-link" aria-controls="categoryPage" aria-selected="false"><i class="fab fa-css3" style="margin-left:3px;"></i><br />SHELF CATEGORY</a></li>
        </ul>
        <div class="tab-content" style="border: 1px solid silver;border-top:none;">
            <div id="draft" class="tab-pane  in active" role="tabpanel" aria-labelledby="design-tab">
                <div style="width: 100%;" class="p-3">
                    <fieldset class="fieldset">
                        <legend class="fs-legend">Manage Shelf</legend>
                        <div class="text-danger" asp-validation-summary="All"></div>
                        @Html.HiddenFor(x => x.DataAction)
                        @Html.HiddenFor(x => x.NoteId)
                        <div class="row">
                            <div class=" col-5 form-group required">
                                <div class="col-form-label">
                                    <label>Shelf No</label>
                                </div>
                                <input type="text" id="ShelfNo" class="form-control" required="required" />
                            </div>
                            <div class=" col-5 form-group required">
                                <div class="col-form-label">
                                    <label>Shelf Location</label>
                                </div>
                                <input type="text" id="ShelfLocation" class="form-control" required="required" />
                            </div>
                            <div class=" col-2 form-group">
                                <div class="col-form-label">
                                    &nbsp;
                                </div>
                                <button class="btn btn-primary" style="margin:5px;color:white" onclick="onAdd(event)"><i class="fas fa-plus"></i>&nbsp;Save</button>
                                <input type="button" class="btn btn-danger" value="Reset" onclick="OnReset();" />
                            </div>
                        </div>

                    </fieldset>
                    <fieldset class="fieldset">
                        <legend class="fs-legend">Shelf List</legend>
                        <div id="ShelfListGrid" style="width: 100%;height:550px" class="ag-theme-alpine"></div>
                    </fieldset>
                </div>
            </div>

            <div id="categoryPage" class="tab-pane " role="tabpanel" aria-labelledby="pageCss-tab">
            </div>


        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $(".nav li.disabled a").click(function () {
            return false;
        });
    });

    var columnDefs = [
        {
            field: "ShelfNo",
        },
        { field: "ShelfLocation" },
        {
            headerName: "Actions",
            field: "Id",
            cellRenderer: params => {
                return "<div class='btn-group grid-menu' id='tree-menuBinItemShelfUser' data-idvalue='" + params.value + "' data-status=\"0\" data-noteid='" + params.data.NoteId + "' ><i class='fas fa-ellipsis-v'></i></div>"
            }
        }
    ];

    $(function () {

        GetShelfList();
        $.contextMenu({
            selector: '#tree-menuBinItemShelfUser',
            trigger: 'left',
            build: function ($trigger, e) {


                var id = $trigger.data('idvalue');
                var noteId = $trigger.data('noteid');
                //var portalName = $trigger.data('portal-name');

                switch (0) {
                    case 0:
                        return {
                            callback: function (key, options) {
                                switch (key) {
                                    case 'edit':
                                        OnEdit(noteId);
                                        break;
                                    case 'itemCategory':
                                        onItemShelfCategory(id);
                                        break;


                                    default:
                                }
                            },
                            items: {
                                "edit": { name: "Edit", icon: "fas fa-pencil" },
                                "itemCategory": { name: "Item Shelf Category", icon: "fas fa-user-shield" },




                            }
                        };


                }
            }
        });


    });


   function GetShelfList() {
       document.getElementById("ShelfListGrid").innerHTML = "";
       gridConfig(
           "ShelfListGrid",
           "/Ims/InventoryMaster/ReadShelfList",
           columnDefs,
           false,
           true,
           true,
           true,
           1,
           true,
           10);
    }

    function onAdd(e)
    {
        var shNo = $("#ShelfNo").val();
        var shName = $("#ShelfLocation").val();

        if (shNo == null || shNo == '' || shNo == undefined) {
            $(".text-danger").removeClass("validation-summary-valid");
            $(".text-danger").addClass("validation-summary-errors");
            $(".text-danger").html("Shelf No is required");
            e.preventDefault();
            return false;
        }
        else if (shName == null || shName == '' || shName == undefined) {
            $(".text-danger").removeClass("validation-summary-valid");
            $(".text-danger").addClass("validation-summary-errors");
            $(".text-danger").html("Shelf Location is required");
            e.preventDefault();
            return false;
        }
        else {
            $(".text-danger").removeClass("validation-summary-errors");
            $(".text-danger").addClass("validation-summary-valid");
            $(".text-danger").html("");

            ShowLoader($("#cms-Content"));
            $.ajax({
                url: "/Ims/InventoryMaster/ManageItemShelf",
                type: "POST",
                data: {
                    ShelfNo: $("#ShelfNo").val(),
                    ShelfLocation: $("#ShelfLocation").val(),
                    DataAction: $("#DataAction").val(),
                    NoteId: $("#NoteId").val()
                },
                cache: false,
                success: function (res) {
                    if (res.success) {
                        HideLoader($("#cms-Content"));
                        ShowNotification("Saved Successfully", "success");
                        OnReset();
                        GetShelfList();
                    }
                    else {
                        HideLoader($("#cms-Content"));
                        ShowNotification(res.error, "error");
                    }
                    
                }
            });
        }
        
    }
    function OnEdit(noteId)
    {
        ShowLoader($("#cms-Content"));
        $("#DataAction").val('@DataActionEnum.Edit');
        $("#NoteId").val(noteId);
           $.ajax({
               url: "/Ims/InventoryMaster/GetItemShelfDetail?noteId=" + noteId,
             type: "GET",

            cache: false,
             success: function (data) {
                 HideLoader($("#cms-Content"));
                 $("#ShelfNo").val(data.ShelfNo);
                 $("#ShelfLocation").val(data.ShelfLocation);
            }
        });

    }
    function OnReset() {
         $("#ShelfNo").val('');
        $("#ShelfLocation").val('');
        $("#DataAction").val('@DataActionEnum.Create');
        $("#NoteId").val('');
    }
    function onItemShelfCategory(id) {

        $("#categoryTab").show();

        $('#myTabs a[href="#categoryPage"]').tab('show');
        LoadPartailView('/Ims/InventoryMaster/ItemShelfCategory?ItemShelfId=' + id, $('#categoryPage'));
    }

</script>