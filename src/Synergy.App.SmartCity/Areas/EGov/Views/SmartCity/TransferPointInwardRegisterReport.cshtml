@using Synergy.App.ViewModel;
@using Synergy.App.Common;


@{
    ViewData["Title"] = "WTP Inward Register";
    Layout = null;
}

@inject Synergy.App.Common.IUserContext _userContext
<style>

    .k-grid-header .k-header {
        position: relative;
        vertical-align: bottom;
        cursor: default;
        font-weight: 600 !important;
    }

    .k-grid .k-grid-header .k-header .k-link {
        overflow: visible !important;
        white-space: normal !important;
    }


    .k-header {
        position: relative;
        vertical-align: bottom;
        cursor: default;
        font-weight: 600 !important;
    }

    .k-header {
        overflow: visible !important;
        white-space: normal !important;
    }
</style>

<script>
    
   //$("#transferstation").kendoDropDownList({
   //     dataTextField: "Name",
   //     dataValueField: "Id",
   //     optionLabel: "@ApplicationConstant.PlaceHolder_SelectOption",
   //     dataSource: {
   //         severFiltering: true,
   //         transport: {
   //             read: {
   //                 url: "/EGov/SmartCity/GetTransferStationList",
   //             }
   //         }
   //     }
   // });


    $("#startDate").kendoDatePicker({
            value: new Date(new Date().setMonth(new Date().getMonth())),
            format: "dd-MM-yyyy",
            dateInput: false
        });

        $("#startDate").attr("disabled", "disabled");


        $("#endDate").kendoDatePicker({
            value: new Date(new Date().setMonth(new Date().getMonth())),
            format: "dd-MM-yyyy",
            dateInput: false
        });

        $("#endDate").attr("disabled", "disabled");


    var columnDefs = [
        {
            headerName: "Sr.No",
            field: "SlNo",
            attributes:{style:"text-align:right;"}
        },
        {
            title: "Vehicle Number",
            field: "VehicleNumber",
        },
        {
            title: "Ward Number",
            field: "WardNumber",
        },
        {
            title: "Vehicle Type",
            field: "VehicleType",
        },

        {
            title: "Vehicle Capacity(Sum)",
            field: "VehicleCapacity",
            attributes:{style:"text-align:right;"}
        },
        {
            title: "Vehicle Reaching Time",
            field: "VehicleReachingTime",
            attributes:{style:"text-align:right;"}
        },
      
    ];

    var columnDefs1 = [
        {
            title: "Vehicle Departure Time",
            field: "VehicleDepartureTime",
            attributes: { style: "text-align:right;" }
        },
        {
            title: "Waste Dumped By primary Collection Vehicle",
            columns: [
                {
                    title: "Wet Waste",
                    field: "WetWaste",
                    attributes: { style: "text-align:right;" }
                },
                {
                    title: "Dry Waste",
                    field: "DryWaste",
                    attributes: { style: "text-align:right;" }
                },]
        },
        {
            title: "Remarks",
            field: "Remarks",
        },
    ];

   function getReportData() {
        debugger;
        var startDate = kendo.toString($("#startDate").data("kendoDatePicker").value(), 'yyyy-MM-dd');
       // var transferstation = $("#transferstation").val('@ViewBag.TransferStationId');

       // var endDate = kendo.toString($("#endDate").data("kendoDatePicker").value(), 'yyyy-MM-dd');
       //var transferstation = $("#transferstation").val();
       //if (transferstation == undefined || transferstation == null) {
       //     alert("Select Transferstation")
       // }
        if (startDate == undefined || startDate == null) {
            alert("Select Date")
        }  else {
            //$.ajax({
            //    url: '/EGov/SmartCity/GetTransferStationDetails?transferStationId=' + transferstation,
            //    type: "GET",
            //    dataType: "json",
            //    success: function (result) {
                    var url = "/EGov/SmartCity/GetJSCInwardReport?&date=" + startDate; //+ "&endDate=" + endDate;
                    //console.info(result);
                    var grid = $("#kGridView").kendoGrid({
                        toolbar: ["excel", "pdf"],
                        pdf: {
                              fileName: "WTPRegisterReport.pdf",
                              allPages: true,
                              paperSize: "A3",
                              margin: { top: "2cm", right: "0.5cm", bottom: "1cm", left: "0.5cm" },
                              landscape: true,
                              scale: 0.8
                            },
                        excelExport: function (e) {
                            var sheet = e.workbook.sheets[0];
                            for (var i = 0; i < sheet.rows.length; i++) {
                                for (var ci = 0; ci < sheet.rows[i].cells.length; ci++) {
                                    var cell = sheet.rows[i].cells[ci];
                                    // add borders
                                    cell.borderTop = { color: "black", size: 1 };
                                    cell.borderRight = { color: "black", size: 1 };
                                    cell.borderBottom = { color: "black", size: 1 };
                                    cell.borderLeft = { color: "black", size: 1 };

                                    // change cell background
                                    cell.background = "#ffffff";
                                    cell.color = "black";
                                    if (i == 0) {
                                        cell.hAlign = "center";
                                    }
                                    if (i >= 0 && i < 5) {
                                        cell.bold = true;
                                    }
                                }
                            }
                        },
                        excel: {
                            fileName: "WTPInwardRegister_Report.xlsx",
                            proxyURL: "https://demos.telerik.com/kendo-ui/service/export",
                            filterable: true,

                        },
                        dataSource: {
                            type: "json",
                            transport: {
                                read: url
                            },
                        },
                        height: 550,
                        groupable: false,
                        sortable: true,
                        resizable: true,
                        reorderable: true,
                        pageable: {
                            alwaysVisible: false,
                            pageSizes: [5, 10, 20, 100]
                        },                        //columnMenu: true,
                        columns: [{
                            title: "Jammu Municipal Corporation WTP Inward Register",
                            headerAttributes: { "class": "k-text-center !k-justify-content-center" },
                            columns: [
                                {
                                    title: "Location Of Transfer Point: ", //+ result.Id,
                                    columns: [
                                        {
                                                   title: "Date: " + $("#startDate").val().toString("dd-MM-yyyy"),
                                                   columns: columnDefs
                                        },]
                                },
                                {
                                    title: "Supervisor Name: "/* + result.Name*/,
                                    columns: [{
                                        title: "",
                                        columns: columnDefs1
                                    },]
                                }]

                        }]
                    });
            //    }
            //});
        }
    }


</script>
<div class="p-2">
    <h4>
        Jammu Municipal Corporation WTP Inward Register
    </h4>
</div>


<div class="row" style="padding:2%">
   @* @if (_userContext.IsSystemAdmin)
    {
        
    }*@

   @* <div class="col">
        <div class="form-label-group">
            <div>
                <span style="color:red">*</span> <label for="auto">Select Transferstation</label>
            </div>
            <input required id="transferstation" class="form-control" />
            <script>
            </script>
        </div>
    </div>*@

    <div class="col">
        <div class="form-label-group">
            <div>
                <span style="color:red">*</span> <label for="TravelDate">Select Start Date</label>
            </div>
            <input required id="startDate" class="form-control" />
        </div>
    </div>
 @*   <div class="col">
        <div class="form-label-group">
            <div>
                <span style="color:red">*</span> <label for="TravelDate">Select End Date</label>
            </div>
            <input required id="endDate" class="form-control" />
        </div>
    </div>
*@

    <div class="col" style="padding-top: 2%;">
        <button class="btn btn-primary" onclick="getReportData()">Show Report</button>
    </div>

</div>

<style>
    #vNo, #wNo, #solidWasteCapacity {
        font-weight: bold
    }
</style>

<div class="col-12 p-2">
    <div id="kGridView" style="width: 100%;height:500px" class="ag-theme-alpine"></div>
</div>