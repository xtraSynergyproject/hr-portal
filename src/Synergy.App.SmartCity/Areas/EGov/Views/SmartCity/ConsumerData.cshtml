@using System.Text;
@using Synergy.App.ViewModel;
@using Synergy.App.Common;

@model JSCParcelViewModel

@{
    ViewData["Title"] = "Asset Details";
    Layout = null;
}


<style>
    .colLabel {
        color: black !important;
    }

    .ag-theme-balham .ag-header-row .ag-header-cell-text {
        color: black !important;
    }

    .divDim {
        width: 100%;
        height: 100%;
        min-height: calc(100vh - 6.5rem);
        margin: auto;
    }
</style>

<script>

    $(function () {
        getAssetList();
        getConsumerPaymentList();

        $.contextMenu({
            selector: '#viewAction',
            trigger: 'left',
            build: function ($trigger, e) {


                var id = $trigger.data('idvalue');

                switch (0) {
                    case 0:
                        return {
                            callback: function (key, options) {
                                switch (key) {
                                    case 'view':
                                        onView(id);
                                        break;

                                    default:
                                }
                            },
                            items: {
                                "view": { name: "View Asset Details", icon: "fas fa-eye" },

                            }
                        };


                }
            }
        });

    });

    function onView(id) {
        @*var customUrl = encodeURIComponent(id);
        LoadPartailView('/EGov/SmartCity/AssetData?backEnable=true&id=' + id+'&consumerId=@Model.Id', $('#cms-content'));*@
        var url = '/Egov/SmartCity/JSCPropertyDetails?propertyId='+id;
        var win = GetMainWindow();
        win.iframeOpenUrl = url;
        win.OpenWindow({ Title: "Property Details", Width: 1200, Height: 600 });
        return false;
    }


    var assetColumnDefs = [
        {
            headerName: "View",
            field: "gid",
            minWidth: 90,

            cellRenderer: params => {
                return "<div class='btn-group grid-menu' id='viewAction' data-idvalue='" + params.value + "' ><i class='fas fa-ellipsis-v'></i></div>"
            }
        },
        //{
        //    field: "pcl_id",
        //    headerName: "Parcel Id",
        //    minWidth: 150
        //},
        {
            field: "prop_id",
            headerName: "Property Id",
            minWidth: 150
        },
        //{
        //    field: "AssetDescription",
        //    headerName: "Asset Description",
        //    minWidth: 150
        //},
        {
            field: "ward_no",
            headerName: "Ward No",
            minWidth: 150
        },
        {
            field: "locality",
            headerName: "Locality",
            minWidth: 150
        },
        {
            field: "sub_loc",
            headerName: "Sub Locality",
            minWidth: 150
        },
        {
            field: "usg_cat_gf",
            headerName: "Usage Type",
            minWidth: 150
        },
        //{
        //    field: "AllotmentDate",
        //    headerName: "Asset Allotment Date",
        //    minWidth: 180,
        //    cellRenderer: params => {
        //        var date = new Date(params.value);
        //        return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        //    }
        //},
        //{
        //    field: "AllotmentFromDate",
        //    headerName: "Allotment From Date",
        //    minWidth: 180,
        //    cellRenderer: params => {
        //        var date = new Date(params.value);
        //        return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        //    }
        //},
        //{
        //    field: "AllotmentToDate",
        //    headerName: "Allotment To Date",
        //    minWidth: 150,
        //    cellRenderer: params => {
        //        var date = new Date(params.value);
        //        return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
        //    }
        //}
    ];

    function getAssetList() {
        document.getElementById("assetGrid").innerHTML = "";
        gridConfig(
            "assetGrid",
            "/EGov/SmartCity/GetConsumerAssetData2?mobileNo=@Model.tel_no&aadhar=@Model.aadhar",
            assetColumnDefs,
            false,
            true,
            true,
            true,
            1,
            true,
            10);
    }

    var consumerPaymentColumnDefs = [
        //{
        //    field: "pcl_id",
        //    headerName: "Parcel Id",
        //    minWidth: 150,
        //},
        {
            field: "prop_id",
            headerName: "Property Id",
            minWidth: 150,
        },
        {
            field: "Amount",
            headerName: "Amount",
            minWidth: 150,
        },
        {
            field: "PaymentDate",
            headerName: "Payment Date",
            minWidth: 150,
            cellRenderer: params => {
                var date = new Date(params.value);
                return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
            }
        },
        {
            field: "DueDate",
            headerName: "Due Date",
            minWidth: 150,
            cellRenderer: params => {
                var date = new Date(params.value);
                return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
            }
        },
        {
            field: "ReferenceNo",
            headerName: "Payment Reference No",
            minWidth: 150,
        },
        {
            field: "PaymentStatusName",
            headerName: "Payment Status",
            minWidth: 150,
        },
        {
            field: "PaymentModeName",
            headerName: "Payment Mode",
            minWidth: 150,
        },
        {
            field: "RevenueTypeName",
            headerName: "Revenue Type",
            minWidth: 150,
        },
        {
            field: "PaymentFromDate",
            headerName: "Payment From Date",
            minWidth: 150,
            cellRenderer: params => {
                var date = new Date(params.value);
                return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
            }
        },
        {
            field: "PaymentToDate",
            headerName: "Payment To Date",
            minWidth: 150,
            cellRenderer: params => {
                var date = new Date(params.value);
                return date.getDate() + "/" + (date.getMonth() + 1) + "/" + date.getFullYear();
            }
        }
    ];

    function getConsumerPaymentList() {
        document.getElementById("consumerPaymentGrid").innerHTML = "";
        gridConfig(
            "consumerPaymentGrid",
            "/EGov/SmartCity/GetConsumerPaymentData2?mobileNo=@Model.tel_no&aadhar=@Model.aadhar",
            consumerPaymentColumnDefs,
            false,
            true,
            true,
            true,
            1,
            true,
            10);
    }

    function goBackToAsset(id) {
        LoadPartailView('/EGov/SmartCity/AssetData?id=' + id, $('#cms-content'));
    }

</script>

<div id="appWrapper" class="wrapper">
    <div class="page">
        <div class="page-inner">
            <div class="jumbotron divDim">
                <div class="text-center">
                    <h5>CONSUMER DETAILS</h5>
                    <h6>@Model.own_name</h6>
                </div>
                <hr />
                @if (ViewBag.BackEnable)
                {
                    <button class="btn btn-secondary btn-sm" onclick="goBackToAsset('@ViewBag.AssetId')" style="float:right;">Back</button>
                }
                <div>
                    <ul class="nav nav-tabs card-header-tabs">
                        <li class="nav-item">
                            <a class="nav-link active show" data-toggle="tab" href="#consumer">Consumer Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#asset">Asset Details</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-toggle="tab" href="#payment">Payment Details</a>
                        </li>
                    </ul>
                </div>
                <hr />

                <div>
                    <div class="tab-content">
                        <div class="tab-pane fade active show text-center" id="consumer">

                            <div class="row">
                                <div class="col-3 text-left">
                                    <label class="col-form-label">Consumer Name</label>
                                </div>
                                <div class="col-3 text-left">
                                    <label class="col-form-label colLabel">@Model.own_name</label>
                                </div>

                                <div class="col-3 text-left">
                                    <label class="col-form-label">Consumer Details</label>
                                </div>
                                <div class="col-3 text-left">
                                    <label class="col-form-label colLabel">@Model.own_dtls</label>
                                </div>

                                @*<div class="col-3 text-left">
                                    <label class="col-form-label">Email</label>
                                </div>
                                <div class="col-3 text-left">
                                    <label class="col-form-label colLabel">@Model.e_mail_id</label>
                                </div>*@

                                <div class="col-3 text-left">
                                    <label class="col-form-label">Mobile</label>
                                </div>
                                <div class="col-3 text-left">
                                    <label class="col-form-label colLabel">@Model.tel_no</label>
                                </div>

                                <div class="col-3 text-left">
                                    <label class="col-form-label">Aadhar No</label>
                                </div>
                                <div class="col-3 text-left">
                                    <label class="col-form-label colLabel">@Model.aadhar</label>
                                </div>
                            </div>

                        </div>
                        <div class="tab-pane fade" id="asset">
                            <div id="assetGrid" style="width: 100%;height:350px" class="ag-theme-balham"></div>
                        </div>
                        <div class="tab-pane fade" id="payment">
                            <div id="consumerPaymentGrid" style="width: 100%;height:350px" class="ag-theme-balham"></div>
                        </div>
                    </div>
                </div>


            </div>
        </div>
    </div>
</div>
