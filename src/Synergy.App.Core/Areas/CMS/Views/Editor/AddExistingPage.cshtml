@using Synergy.App.ViewModel;
@using Synergy.App.Common;
@using Newtonsoft.Json;

@{
    ViewData["Title"] = "Add Existing Page";
    Layout = "/Areas/Core/Views/Shared/_PopupLayout.cshtml";
}

<div class="row" style="margin:15px;margin-bottom:60px;">


    <div class="row col-12 pad-10">
        <div class="col-3">
            Category <span class="required">*</span>
        </div>
            <div class="col-9">

                <input id="CategoryId" style="width:100%" />
            </div>
        </div>
    <div class="row col-12 pad-10">
        <div class="col-3">
            Book <span class="required">*</span>
        </div>
        <div class="col-9">
            <input id="BookId"  style="width:100%"/>
        </div>
    </div>
    <div class="row col-12 pad-10">
        <div class="col-3">
            Page <span class="required">*</span>
        </div>
        <div class="col-9">
            <input id="PageId"  style="width:100%"/>


        </div>
    </div>


    <div class="cms-slidebar-footer">
        <button type="button" class="btn btn-light" onclick="closeNavMemberGroup();">Close</button>
        <input type="button" class="btn btn-primary" value="Ok" onclick="MapBookPages()" />
    </div>



</div>
<script>

    $(document).ready(function () {


        $("#CategoryId").kendoDropDownList({
            dataTextField: "CategoryName",
            dataValueField: "Id",
            dataSource: {
                transport: {
                    serverFiltering: true,
                    read: {
                        url: "/cms/NtsService/GetCategoryById?categoryId=@ViewBag.CategoryId",
                        dataType: "json"
                    }
                },
            },
            change: function (e)
            {
                
                var catId = $("#CategoryId").data("kendoDropDownList").value();
                $("#BookId").data("kendoDropDownList").dataSource.read({ categoryId: catId})
            },
            optionLabel: "Select Category...",
            value: '@ViewBag.CategoryId',


            filter: '@FilterType.Contains',
        }).data("kendoDropDownList");
        @*$("#CategoryId").data("kendoDropDownList").value('@ViewBag.CategoryId');*@

        $("#BookId").kendoDropDownList({
            dataTextField: "BookName",
            dataValueField: "Id",

            change: function (e) {
                
                var categoryId = $("#BookId").data("kendoDropDownList").value();
                $("#PageId").data("kendoDropDownList").dataSource.read({ bookId: categoryId })
            },
            dataSource: {
                serverFiltering: true,
                transport: {
                    read: {
                        url: "/cms/NtsService/GetBookByCategoryId",
                        data: { categoryId: $("#CategoryId").val()},
                        dataType: "json"
                    }
                },
            },
             autoBind:false,
            optionLabel: "Select Book..",
            value: '@ViewBag.BookId',
            filter: '@FilterType.Contains',
        }).data("kendoDropDownList");
        @*$("#BookId").data("kendoDropDownList").value('@ViewBag.BookId');*@
        $("#PageId").kendoDropDownList({
            dataTextField: "Name",
            dataValueField: "Id",

            dataSource: {
                serverFiltering: true,
                transport: {
                    read: {
                        url: "/cms/NtsService/GetAllPages" ,
                        data: { bookId: $("#BookId").val() },
                        dataType: "json"
                    }
                },
            },
            autoBind: false,
            optionLabel: "Select Page...",


            filter: '@FilterType.Contains',
        }).data("kendoDropDownList");


    });









    function closeNavMemberGroup() {

        var win = GetMainWindow();
        win.CloseWindow();
        return false;
    }




    function MapBookPages() {            
        var abc = '@ViewBag.CompId';
        var win = GetMainWindow();
        var parent = win.GetParentWindow();
        parent.editor.getComponents().models.find(x => x.cid == abc).attributes.attributes.pageid = $("#PageId").val();
        parent.editor.getComponents().models.find(x => x.cid == abc).attributes.attributes.bookid = $("#BookId").val();
        win.CloseWindow();
        return false;
    }



</script>