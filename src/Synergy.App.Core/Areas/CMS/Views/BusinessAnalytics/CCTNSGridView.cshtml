
@using Synergy.App.ViewModel;
@using Synergy.App.Common;

 @model System.Data.DataTable

     
@*<h4 style="text-align: center; background: #006699; color: white; margin-bottom: 0px; padding-top: 6px; padding-bottom: 6px;">@ViewBag.Heading</h4>*@
<div class="row">
    <button class="btn btn-sm btn-primary" onclick="onBtnExport()" style="font-weight: bold; margin-bottom: 10px; margin-left: 15px;">Export</button>
    <div class="col-12">
        <div id="@ViewBag.IndexName" style="width: 100%;height:550px" class="ag-theme-balham"></div>
    </div>
</div>
<br />
<script>
    function onBtnExport() {
        debugger;
        gridOptions.api.exportDataAsCsv();
    }
    var columnDefs = [

        //{
        //    field: "View",
        //    headerName: "View",
        //    cellRenderer: params => {
        //        return "<span class='fas fa-eye' onclick='onMonitorView()'></span>";
        //    }
        //},
        @foreach (System.Data.DataColumn column in Model.Columns)
        {
            @:{ field: '@column.ColumnName',headerName:toTitleCaseGrid('@column.ColumnName'), minWidth: 150, maxWidth: 300, cellRenderer: params => {  if (params.data.@column.ColumnName != null && params.data.@column.ColumnName != undefined) { return "<div class='text-justify' >" + params.data.@column.ColumnName + " </div>"; }else { return "";}} },
        }
    ];
    $(function () {
        document.getElementById("@ViewBag.IndexName").innerHTML = "";
        var url = "/cms/BusinessAnalytics/ReadCCTNSApiDetails?indexName=@ViewBag.IndexName&filterColumn=@ViewBag.FilterColumn&fromDate=@ViewBag.FromDate&todate=@ViewBag.ToDate&queryStr=@ViewBag.queryStr";
        debugger;
        gridConfig(
            "@ViewBag.IndexName",
            url,
            columnDefs,
            false,
            true,
            true,
            true,
            1,
            true,
            10);

    });
    var gridOptions;
    function gridConfig(selector,
        url,
        columns,
        editableC,
        sortableC,
        resizableC,
        filterC,
        flexC,
        paginationC,
        pageSizeC,
    ) {

        ShowLoader($('#' + selector));
        $.ajax({
            url: url,
            type: "GET",
            contentType: "application/json",
            dataType: "JSON",
            success: function (response) {
                HideLoader($('#' + selector));
                document.getElementById(selector).innerHTML = "";
                if (response.length >= 0) {

                    var tabledata = response;

                    // specify the columns
                    const columnDefs = columns;

                    // specify the data
                    const rowData = tabledata

                    // let the grid know which columns and what data to use
                    gridOptions = {
                        defaultColDef: {
                            editable: editableC,
                            sortable: sortableC,
                            resizable: resizableC,
                            filter: filterC,
                            flex: flexC,
                        },
                        columnDefs: columnDefs,
                        rowData: rowData,
                        pagination: paginationC,
                        paginationPageSize: pageSizeC,

                    };

                    const eGridDiv = document.querySelector('#' + selector);
                    new agGrid.Grid(eGridDiv, gridOptions);
                    return gridOptions
                } else {
                }
            },
            error: function (ert) {
                HideLoader($('#' + selector));
            }
        });
    }


</script>