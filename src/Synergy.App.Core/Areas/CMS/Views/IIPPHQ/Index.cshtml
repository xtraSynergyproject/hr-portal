@using Synergy.App.ViewModel;
@using Synergy.App.Common;

@{
    ViewData["Title"] = "Report Dashboard";
    Layout = null;
}


<style>
    body {
        font-family: 'Inter', sans-serif;
    }

    .ag-header-cell-text {
        color: black;
        font-weight: 200;
        font-size: medium;
    }

    .ag-row:hover {
        background-color: #fbfcfd;
    }

    .ag-header-cell {
        /*background-color: #DCDCDC;*/
        background-color: #fff;
        color: black;
    }

    .dashboard {
       /* position: fixed;
        top: 15%;
        left: 10%;*/
    }

    .ag-root-wrapper-body.ag-layout-normal {
        min-height: 200px !important;
    }

    .btn-primary {
        background-color: #006bb4;
        border-color: #006bb4;
        color: #fff;
        position: relative;
        top: 0;
        transition: top ease 0.3s;
    }

        .btn-primary:hover {
            background-color: #0060a2;
            top: -2px;
        }

            .btn-primary:hover .button-text {
                text-decoration: underline;
            }

    .button-text {
        margin-left: 5px;
        font-size: medium;
    }
</style>
<script>

    var columnDefs = [
        {
            field: "NoteSubject",
            maxWidth: 200,
            headerName: 'Name',

        },
        {
            field: "NoteDescription",
            headerName: 'Description',
        },
        {
            headerName: "Actions",
            field: "Id",
            maxWidth: 140,
            cellRenderer: params => {
                ui = document.createElement('div');
                ui.innerHTML = `
                    <span style="margin-right:10px;">
                        <a class='fas fa-eye btn-view'></a>
                    </span>
                    &nbsp;&nbsp;
                    <span style="margin-right:10px;">
                        <a class='fas fa-pencil-alt btn-edit'></a>
                    </span>
                    &nbsp;&nbsp;
                    <span>
                        <a class='fas fa-trash-alt btn-del')></a>
                    </span>
                `;
                viewClick = ui.querySelector('.btn-view');
                editClick = ui.querySelector('.btn-edit');
                delClick = ui.querySelector('.btn-del');

                viewEventListener = () => onView(params.value);
                viewClick.addEventListener('click', viewEventListener);

                editEventListener = () => onEdit(params.value);
                editClick.addEventListener('click', editEventListener);

                delEventListener = () => OnDelete(params.value);
                delClick.addEventListener('click', delEventListener);
                return ui;
            }
        }
    ];

    $(function () {
        getReportDashboardData();
    });
    function OnCreate() {

        var win = GetMainWindow();
        win.iframeOpenUrl =  '@Url.Action("ManageReport", "IIPPHQ", new { @area="Cms"})?dataAction=@DataActionEnum.Create';
        win.OpenWindow({ Title: 'Manage Report', Width: 1000, Height: 600 });
        return false;

    }

    function redirectToPage(Prms) {
        LoadPartailView('/Cms/IIPPHQ/ReportItem?id=' + Prms, $('#cms-content'));
    }

    function onView(id) {
        LoadPartailView('@Url.Action("ReportView", "IIPPHQ", new { @area = "Cms" })?id=' + id, $('#cms-content'));
    }
    function onEdit(id) {
        LoadPartailView('@Url.Action("EditReportItem", "IIPPHQ", new { @area = "Cms" })?id=' + id +'&canback=true', $('#cms-content'));
    }

    function OnDelete(id) {
        var flag = confirm('Do you really want to delete?');

        if (flag) {
            $.ajax({
                url:'@Url.Action("DeleteNote", "NtsNote", new { @area= "Cms" })?Id=' + id,
                type: 'POST',
                data: {},
                dataType: 'json',
                success: function (result) {

                    if (result.success) {
                        getReportDashboardData();
                        kendo.alert("Deleted Successfully.");
                    } else {
                        getReportDashboardData();
                        var err = result.errors.BinderCountError.errors[0];
                        kendo.alert(err);
                    }
                },
                error: function (ert) {
                    getReportDashboardData();
                }
            });
            return false;
        }
    }

    function getReportDashboardData() {
       document.getElementById("ReportDashboardGrid").innerHTML = "";
       gridConfig(
           "ReportDashboardGrid",
           "/cms/IIPPHQ/ReadStackGridDashboardList",
           columnDefs,
           false,
           true,
           true,
           true,
           1,
           true,
           5);
    }

</script>

<div id="grid-stack-content">

    <div class="card shadow dashboard" @*style="width: 80%;"*@>
        <div class="card-body">
            <div class="row" style="margin-bottom: 5px;">
                <div class="col-9" style="justify-content: center">
                    <h1>Reports</h1>
                </div>
                <div class="col-3 ">                    
                    <button type='button' class='btn btn-primary shadow' onclick='OnCreate();' style="float:right;">
                        <span class="button-body">
                            <span class="fa fa-plus-circle"></span>
                            <span class="button-text">Create Report</span>
                        </span>
                    </button>

                </div>
            </div>
            <hr />
            <div class="row">
                <div class="col-12">                   
                    <div id="ReportDashboardGrid" style="/*width: 100%;*/ height: 540px;" class="ag-theme-material"></div>
                </div>
            </div>
        </div>
    </div>
</div>













