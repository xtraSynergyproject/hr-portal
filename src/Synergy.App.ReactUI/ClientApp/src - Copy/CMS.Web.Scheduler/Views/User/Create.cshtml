@using Syncfusion.EJ2.Navigations
@using CMS.UI.ViewModel; 
@using CMS.Common
@{
    ViewData["Title"] = "Create User";
    Layout = "/Views/Shared/_PopupLayout.cshtml";
}
@model CMS.UI.ViewModel.UserViewModel

<style>
    .avatar-myProfile {
        border-radius: 50%;
        height: 80px;
        width: 80px;
    }
</style>
<form asp-controller="User" asp-action="Create" method="post" class="form-horizontal">
    <div class="text-danger" asp-validation-summary="All"></div>
    <div class="row" style="padding:10px;">
        <div class="col-md-12">
            <div class="row" style="margin-bottom:10px !important;">
                @*<div style="width: 80px !important;margin-left: 10px !important;">
                    @if (Model.PhotoId != null)
                    {
                        <img class="avatar-myProfile" src="/user/profilephoto?id=@Model.PhotoId" onerror='OnPhotoError(this);' />
                    }
                    else
                    {
                        <img class="avatar-myProfile" style="background-color:gray;" src="/images/profile.jpg" />
                    }

                </div>*@
                <div style="width: 200px !important; margin-left: 15px !important;">
                    @*@(Html.Kendo().Upload().Multiple(false)
            .Name("files")
            .Async(a => a
            .Save("Save", "Document")
            .AutoUpload(true)
            )
            .Events(e => e.Success("onFileUploadSuccess")
            )
                .Validation(validation => validation.AllowedExtensions(new string[] { ".gif", ".jpg", ".png" }).MaxFileSize(2097152))
                .HtmlAttributes(new { @class = "hr-xx-large" })
        )*@

                    @{
                        await Html.RenderPartialAsync("~/Views/Shared/_FileUpload.cshtml", new FileUploadViewModel { Property = nameof(Model.PhotoId), Value = Model.PhotoId });
                    }
                </div>
            </div>
            <div class="form-label-group">
                <input type="text" asp-for="Name" class="form-control" placeholder="Name" autocomplete="off" required="required" />
                <label for="name">Name</label>
            </div>
            <div class="form-label-group">
                <input type="email" asp-for="Email" class="form-control" placeholder="Email" required="required" autocomplete="off">
                <label for="email">Email</label>
            </div>
            <div class="form-label-group">
                <input type="password" asp-for="Password" class="form-control" placeholder="Password" required="required" autocomplete="off">
                <label for="password">Password</label>
            </div>
            <div class="form-label-group">
                <input type="text" asp-for="JobTitle" class="form-control" placeholder="Job Title" required="" autocomplete="off">
                <label for="jobtitle">Job Title</label>
            </div>
            <div class="form-label-group">
                <select asp-for="Status" class="form-control" placeholder="Status" required="required" autofocus="" style="padding-top: 15px !important; height: 60px !important;">
                    @foreach (Enum status in System.Enum.GetValues(typeof(StatusEnum)))
                    {
                        <option value="@status">@status.ToString()</option>
                    }
                </select>
                <label for="Status" style="margin-top: -20px !important;">Status</label>
            </div>

        </div>
        <div class="col-sm-12">
            <button type="submit" class="btn btn-primary">Save</button>
            <button type="button" class="btn btn-light" onclick="CloseIframeModal(true);">Close</button>
        </div>
    </div>
    @Html.HiddenFor(x => x.PhotoId);
</form>

<script type="text/javascript">

    function onFileUploadSuccess(e) {
        if (e.response.success) {
            //alert(e.response.fileId);
            //console.log(e);
            // set file id to hdden fileid proprty
            $.ajax({
                url: "/user/ChangeUserProfilePhoto?photoId=" + e.response.fileId,
                type: "GET",
                contentType: "application/json",
                dataType: "JSON",
                success: function (response) {
                    
                    $(".avatar-myProfile").attr("src", "/user/profilephoto?id=" + e.response.fileId);
                    $("#PhotoId").val(e.response.fileId);
                }
            });

        }
        else {
            //var msg = ExtractError(e.response.errors, true);
            //alert(msg);
        }
        return true;
    }
</script>