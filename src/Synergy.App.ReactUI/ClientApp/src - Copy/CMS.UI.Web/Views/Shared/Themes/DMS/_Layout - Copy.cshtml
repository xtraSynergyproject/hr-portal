@using CMS.Common;
@inject CMS.Common.IUserContext _userContext
@inject Microsoft.Extensions.Configuration.IConfiguration Configuration
@inject IStringLocalizer<CMS.UI.Web.Areas.DMS.Controllers.DocumentController> Resource
@{ var bannerHeight = 65;
    var returnUrl = "";
    var menuWidth = 600;
    string viewBagPortalId = Convert.ToString(ViewBag.PortalId);
    string footerText = Convert.ToString(ViewBag.Footer);
    if (ViewBag.Portal != null)
    {
        bannerHeight = ViewBag.Portal.BannerHeight;
        returnUrl = string.Concat("/portal/", Convert.ToString(ViewBag.Portal.Name));

    } }
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewBag.Title</title>
    @*<link rel="icon" type="image/x-icon" href="~/images/galfaricon.jpeg" />*@
    @if (ViewBag.FavIconId != null)
    {
        <link rel="icon" type="image/x-icon" href="/Cms/document/getimagemongo?id=@ViewBag.FavIconId" />
    }
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/floating-labels.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/jquery-splitter.css" asp-append-version="true" />
    <link href="~/lib/font-awesome/css/all.min.css" rel="stylesheet" type="text/css" asp-append-version="true" />
    <link rel="stylesheet" href="~/lib/jquery-context-menu/dist/jquery.contextMenu.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Themes/HR/css/theme.css" asp-append-version="true" />

    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/common.css" asp-append-version="true" />
    <link href="~/Themes/HR/css/elegant-icons-style.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/Themes/HR/css/style.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/Themes/HR/css/style-responsive.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/Themes/HR/css/line-icons.css" rel="stylesheet" asp-append-version="true" />


    <link href="~/lib/kendo/dist/css/kendo.bootstrap-v4.min.css" rel="stylesheet" type="text/css" asp-append-version="true" />
    <link rel='stylesheet' href='https://cdn.form.io/formiojs/formio.full.min.css'>
    <link rel="stylesheet" href="~/lib/duration-picker/dist/jquery-duration-picker.min.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.syncfusion.com/ej2/material.css" />
    <link rel="stylesheet" href="~/lib/popover/css/jquery.webui-popover.min.css" asp-append-version="true" />

    <script src="~/Themes/HR/lib/jquery/dist/jquery.min.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-ajax-unobtrusive/jquery-ajax-unobtrusive.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js" asp-append-version="true"></script>
    <script src="~/lib/kendo/dist/js/jszip.min.js" asp-append-version="true"></script>
    <script src="~/lib/kendo/dist/js/kendo.all.min.js" asp-append-version="true"></script>
    <script src="~/lib/kendo/dist/js/kendo.aspnetmvc.min.js" asp-append-version="true"></script>
    <script src="~/lib/formio/js/formio.full.js" asp-append-version="true"></script>
    <script src="~/lib/moment/dist/js/moment.min.js" asp-append-version="true"></script>

    <link data-require="jquery-ui@1.11.2" data-semver="1.11.2" rel="stylesheet" href="//code.jquery.com/ui/1.11.2/themes/smoothness/jquery-ui.css" />
    <script data-require="jquery-ui@1.11.2" data-semver="1.11.2" src="//code.jquery.com/ui/1.11.2/jquery-ui.js" asp-append-version="true"></script>
    <link href="~/js/fancytree/fancytree.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/js/fancytree/fancytree.js" asp-append-version="true"></script>
    <script src="~/js/fancytree/query.fancytree.contextMenu.js" asp-append-version="true"></script>


    <script src="https://cdn.syncfusion.com/ej2/dist/ej2.min.js"></script>

    <script src="~/js/jquery-splitter.js" asp-append-version="true"></script>
    <script src="~/js/Encrypt/aes-min.js" asp-append-version="true"></script>

    <script src="~/js/ag-grid/ag-grid-community.min.js" asp-append-version="true"></script>
    <script src="~/js/ag-grid/ag-grid-community.min.noStyle.js" asp-append-version="true"></script>
    <link href="~/js/ag-grid/ag-grid.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/js/ag-grid/ag-theme-alpine.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/js/ag-grid/ag-grid.js" asp-append-version="true"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>

    <link href="~/js/jquery_editor/richtext.min.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/js/jquery_editor/jquery.richtext.js" asp-append-version="true"></script>


    <link href="~/js/dm-uploader/jquery.dm-uploader.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/js/dm-uploader/jquery.dm-uploader.js" asp-append-version="true"></script>
    <script src="~/js/dm-uploader/upload-config.js" asp-append-version="true"></script>
    <script src="~/js/dm-uploader/upload-ui.js" asp-append-version="true"></script>
    <style>
        .ag-theme-alpine .ag-header {
            background-color: #006699 !important;
            color: white !important;
        }

        .ag-header-cell-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: white;
        }

        .ag-theme-alpine .ag-icon-menu::before {
            content: "\f11d";
            color: white;
        }

        .ag-theme-alpine .ag-icon-filter::before {
            content: "\f114";
            color: white;
        }

        .ag-theme-alpine .ag-icon-desc::before {
            content: "\f10f";
            color: white;
        }

        .ag-theme-alpine .ag-icon-asc::before {
            content: "\f103";
            color: white;
        }

        .ag-theme-alpine .ag-row-odd {
            background-color: var(--ag-odd-row-background-color, #e6f7ff);
        }

        .ag-theme-alpine .ag-row {
            border-bottom-style: none;
        }

        .ag-row:hover {
            background-color: #80d4ff;
        }

        .ag-root-wrapper-body.ag-layout-normal {
            min-height: 500px !important;
        }
    </style>
    @*opensource*@


    <script src="~/lib/duration-picker/dist/jquery-duration-picker.min.js" asp-append-version="true"></script>


    <script src="~/lib/popover/js/jquery.webui-popover.min.js" asp-append-version="true"></script>
    <script src="~/js/common.js" asp-append-version="true"></script>
    <script type="text/javascript" src="~/js/cubejs-client-core.umd.js" asp-append-version="true"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin="" />
    <!-- Make sure you put this AFTER Leaflet's CSS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
    <link href="~/css/leafletMap/MarkerCluster.css" rel="stylesheet" />
    <link href="~/css/leafletMap/MarkerCluster.Default.css" rel="stylesheet" />
    <script src="~/js/leafletMap/leaflet.markercluster-src.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    @*<link href="~/css/leafletMap/leaflet.draw.css" rel="stylesheet" />*@
    <script src="~/js/leafletMap/Leaflet.draw.js"></script>
    <script src="~/js/leafletMap/Leaflet-WMS.min.js"></script>
    <script src="~/js/leafletMap/HeatMap.js"></script>
    @*<script src="https://cdn.jsdelivr.net/npm/leaflet-heatmap@1.0.0/leaflet-heatmap.min.js"></script>*@

    @*opensource*@
    <script src="~/js/ag-grid/ag-grid-community.min.js" asp-append-version="true"></script>
    <script src="~/js/ag-grid/ag-grid-community.min.noStyle.js" asp-append-version="true"></script>
    <link href="~/js/ag-grid/ag-grid.css" rel="stylesheet" asp-append-version="true" />
    <link href="~/js/ag-grid/ag-theme-alpine.css" rel="stylesheet" asp-append-version="true" />
    <script src="~/js/ag-grid/ag-grid.js" asp-append-version="true"></script>

    <style>
        .ag-theme-alpine .ag-header {
            background-color: #006699 !important;
            color: white !important;
        }

        .ag-header-cell-text {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: white;
        }

        .ag-theme-alpine .ag-icon-menu::before {
            content: "\f11d";
            color: white;
        }

        .ag-theme-alpine .ag-icon-filter::before {
            content: "\f114";
            color: white;
        }

        .ag-theme-alpine .ag-icon-desc::before {
            content: "\f10f";
            color: white;
        }

        .ag-theme-alpine .ag-icon-asc::before {
            content: "\f103";
            color: white;
        }

        .ag-theme-alpine .ag-row-odd {
            background-color: var(--ag-odd-row-background-color, #e6f7ff);
        }

        .ag-theme-alpine .ag-row {
            border-bottom-style: none;
        }

        .ag-row:hover {
            background-color: #80d4ff;
        }
    </style>
    @*opensource*@
    <script>
        @{
            string CubeJSKey = Configuration.GetSection("CubeJSSettings")["CubeJSKey"];
            string CubeJSBaseUrl = Configuration.GetSection("CubeJSSettings")["CubeJSBaseUrl"];
        }
        $.ajaxSetup({
            beforeSend: function (xhr, options) {
                if (options.type.toUpperCase() == "POST") {
                    xhr.setRequestHeader("RequestVerificationToken", $('input:hidden[name="__RequestVerificationToken"]').val());
                }

            }
        });
        //Chart.defaults.plugins.legend.position = "bottom";
        const COLORS_SERIES = ['#FF6492', '#141446', '#7A77FF'];
        const commonOptions = {
            maintainAspectRatio: false,
        };
        const cubejsApi = cubejs(
            '@CubeJSKey',
            { apiUrl: '@CubeJSBaseUrl'.concat('cubejs-api/v1') } // !!!!! convert to https !!!!!!
        );
        function toTitleCase(str) {
            var arr = str.split('_');
            if (arr.length > 1) {
                str = arr[1].replaceAll('_', ' ');
            }
            else {
                str = str.replaceAll('_', ' ');
            }
            return str.replace(/\w\S*/g, function (txt) {
                return txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase();
            });
        }
        function refreshChart(chartId,param) {
             $.ajax({
                type: "GET",
                 url: "/Cms/BusinessAnalytics/GetChartDataByItemNameWithParams?itemName=" + chartId +"&param="+param,
                success: function (response) {
                    if (response != "" && response != null) {
                        eval(response);
                    }
                },
                error: function (response) {
                    alert("error");
                },
        });
        }
        function refreshIframeChart(chartId, param) {
            $.ajax({
                type: "GET",
                url: "/Cms/BusinessAnalytics/GetIframeDataByItemNameWithParams?itemName=" + chartId + "&param=" + param,
                success: function (response) {
                    if (response != "" && response != null) {
                        eval(response);
                    }
                },
                error: function (response) {
                    alert("error");
                },
            });
        }
    </script>
    <style>
        .menu-carousel .carousel-control-prev, .menu-carousel .carousel-control-next {
            width: 3% !important;
            color: gray !important;
        }

        .menu-carousel .carousel-indicators li {
            background-color: gray !important;
            color: gray !important;
        }

        .menu-carousel {
            border: 1px solid silver !important;
            padding: 10px !important;
            padding-left: 35px !important;
            padding-right: 35px !important;
        }

        .col-level-0 {
            padding-left: 10px !important;
        }

        .col-level-1 {
            padding-left: 25px !important;
        }

        .col-level-2 {
            padding-left: 40px !important;
        }

        .col-level-3 {
            padding-left: 55px !important;
        }

        .dropdown-menu.show {
            display: flex !important;
        }

        .menu-item {
            padding: 6px;
        }

        .menu-group-text {
            color: #e6e6e6 !important;
            font-size: 16px !important;
            text-transform: uppercase;
            vertical-align: middle !important;
            display: flex;
            justify-content: center;
            align-content: center;
            flex-direction: column;
        }

        .menu-item-icon {
            color: #cccccc !important;
            font-size: 18px !important;
        }

        .menu-item-text {
            padding-left: 10px !important;
            color: #cccccc !important;
            font-size: 13px !important;
            text-transform: uppercase;
        }

        .col-color-1, .col-color-4, .col-color-7, .col-color-10, .col-color-13, .col-color-16 {
            background-color: #336699;
            color: #fff !important;
        }

        .col-color-2, .col-color-5, .col-color-8, .col-color-11, .col-color-14, .col-color-17 {
            background-color: #41253a;
            color: #fff !important;
        }

        .col-color-3, .col-color-6, .col-color-9, .col-color-12, .col-color-15, .col-color-18 {
            background-color: #006666;
            color: #fff !important;
        }


        .menu-group {
            padding: 10px;
        }

        .dropdown-menu {
            padding-top: 0px !important;
            padding-bottom: 0px !important;
        }

        .sub-menu-container {
            position: relative;
            height: 400px;
            min-width: 300px;
            margin: 2px auto;
            text-align: left;
            white-space: nowrap;
            overflow-x: auto !important;
            overflow-y: hidden;
            vertical-align: middle;
            flex-wrap: nowrap;
        }

        .menu-container {
            position: relative;
            height: 600px;
            min-width: 300px;
            margin: 2px auto;
            text-align: left;
            white-space: nowrap;
            overflow-x: auto !important;
            overflow-y: hidden;
            vertical-align: middle;
            flex-wrap: nowrap;
        }

        .menu-col {
            width: 300px;
            flex: 0 0 auto;
            white-space: normal;
            text-align: left;
        }
        /*choices form-group formio-choices is-disabled*/
        .hamburger-menu {
            margin-top: 5px;
            /*border-radius: 50%;*/
            color: #2D9FCA;
            padding-left: 6px !important;
            padding-right: 6px !important;
        }

        .dropdown-menu li ul {
            padding-inline-start: 10px !important;
        }

        .dropdown-menu-div {
            padding: 10px;
        }

        .form-control[disabled*="disabled"] {
            background: #D3D3D3
        }

        .lng-active {
            color: #797979 !important;
            font-weight: normal !important;
            cursor: unset !important;
        }

        .nts-banner-text-white {
            position: absolute;
            top: 25px;
            left: 30px;
            font-size: 30px;
            color: #fff !important;
        }

        .nts-banner-text-dark {
            position: absolute;
            top: 25px;
            left: 30px;
            font-size: 30px;
            color: #606060 !important;
        }

        .nts-banner-text-small {
            position: absolute;
            top: 10px;
            left: 15px;
            font-size: 25px;
            color: #606060 !important;
        }

        .lng-item {
            color: #2D9FCA;
            font-weight: bold;
            cursor: pointer;
        }

        .k-popup-right {
            right: 0 !important;
            left: unset !important;
        }

        .div-footer {
            position: fixed;
            z-index: 100;
            height: 38px;
            background-color: dimgray;
            color: #e6e6e6;
            bottom: 0px;
            left: 0px;
            right: 0px;
            margin-bottom: 0px;
        }

        #content-wrapper {
            background-color: #fff !important;
        }

        .slidenav-flow {
            overflow-x: hidden;
            overflow-y: auto !important;
            height: 85%;
        }

        #notification-div {
            transition: margin-left .5s;
            padding: 20px;
        }

        #overlay {
            position: fixed;
            background: rgba(0,0,0,.5);
            -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=30)";
            width: 100%;
            height: 100%;
            z-index: 99;
            right: 100%;
            top: 0;
            transition: right .5s ease;
        }

        .logindetail {
            border-radius: 30px;
            background-color: var(--pbc);
            /*  width: 395.81px;*/
            height: 45px;
            margin-left: 6rem !important;
        }

        .overlay {
            right: 0 !important;
        }

        /*     .logindetail {
                    border-radius: 30px;
                    background-color: #2D9FCA;
                    width: 295.81px;
                    height: 45px;
                    margin-left: 106px;
                }*/

        .menubar {
            color: black;
            border: solid;
            border-radius: 30px;
            width: 40px;
            height: 43px;
            text-align: center;
            border-width: thin;
            padding-top: 0px;
        }

        .nicescroll-rails {
            background-color: #2D9FCA;
        }

        .userlegal > .k-dropdown-wrap {
            color: white;
            border-width: 0px !important;
            border-radius: 0px !important;
            border-color: transparent !important;
            background-color: transparent !important;
            padding-top: 5px !important;
        }

            .userlegal > .k-dropdown-wrap:hover, .userlegal > .k-dropdown-wrap:focus {
                color: white !important;
            }

        .accordion-toggle:after {
            font-family: 'FontAwesome';
            content: "\f078";
            float: right;
        }

        .accordion-opened .accordion-toggle:after {
            content: "\f054";
        }

        .accordion-icon {
            float: right;
        }

        .accordion-heading {
            background-color: var(--pbc);
            background: linear-gradient(90deg,var(--pbc), var(--pbcg));
            padding: 8px;
            cursor: pointer;
            color: #fff;
        }

        .accordion-body {
            border: 1px solid var(--pbc);
            padding: 8px;
        }

        .menu-accordion {
            padding-top: 15px;
            padding-bottom: 15px;
        }

        .accordion-group {
            /*border: 1px solid var(--pbc);*/
            margin-bottom: 5px;
        }

        .sub-menu {
            padding: 10px;
        }

        .wiggle1 {
            animation: shake 5s !important;
        }

        @@keyframes wiggle1 {
            0% {
                transform: translate(1px, 1px) rotate(0deg);
            }

            10% {
                transform: translate(-1px, -2px) rotate(-1deg);
            }

            20% {
                transform: translate(-3px, 0px) rotate(1deg);
            }

            30% {
                transform: translate(3px, 2px) rotate(0deg);
            }

            40% {
                transform: translate(1px, -1px) rotate(1deg);
            }

            50% {
                transform: translate(-1px, 2px) rotate(-1deg);
            }

            60% {
                transform: translate(-3px, 1px) rotate(0deg);
            }

            70% {
                transform: translate(3px, 1px) rotate(-1deg);
            }

            80% {
                transform: translate(-1px, -1px) rotate(1deg);
            }

            90% {
                transform: translate(1px, 2px) rotate(0deg);
            }

            100% {
                transform: translate(1px, -2px) rotate(-1deg);
            }
        }

        /* h4 {
            color: gray !important;
        }*/
        .e-headertext {
            color: gray !important;
            text-transform: uppercase;
        }

        .e-headercell {
            background-color: antiquewhite !important;
        }

        .datagrid-table thead {
            background-color: antiquewhite;
        }

            .datagrid-table thead tr th {
                color: gray !important;
            }
    </style>

    <script type="text/javascript">

        //$(document).ready(function () {
        //    $('.dropdown-submenu a.test').on("click", function (e) {
        //        $(this).next('ul').toggle();
        //        e.stopPropagation();
        //        e.preventDefault();
        //    });
        //});
        $(document).on('show', '.accordion', function (e) {
            // $('.accordion-heading i').toggleClass(' ');
            $(e.target).prev('.accordion-heading').addClass('accordion-opened');
        });

        $(document).on('hide', '.accordion', function (e) {
             $(this).find('.accordion-heading').not($(e.target)).removeClass('accordion-opened');
          // $('.accordion-heading i').toggleClass('fa-chevron-right fa-chevron-down');
        });
        var globalPopups = GetStack();
        var globalCallBack = null;
        var globalWindowSender=null;
        function IsPopupWindow() {
            return (window.frameElement !== null && window.frameElement !== undefined && window.frameElement !== '');
        }
        if (IsPopupWindow()) {
            $("<style>")
                .prop("type", "text/css")
                .html("\
                .clear-padding {\
                    margin-left: 0px !important;\
                    padding-top: 0px!important;\
                    padding-bottom: 0px!important;\
                }\
                .hide-in-popup {\
                    display: none;\
                }")
                .appendTo("head");
        }
        function OpenWindow(winProp) {
            var obj = eval(globalPopups.peek());
            if (winProp.Reload == true) {
            }
            else {
                if (obj === null) {
                    winProp.Id = 1;
                    obj = winProp;
                    globalPopups.push(winProp);
                }
                else {
                    winProp.Id = eval(obj.Id) + 1;
                    obj = winProp;
                    globalPopups.push(winProp);
                }
            }

            var name = "popup_" + obj.Id;
            var wnd = $("#" + name).data("kendoWindow");
            if (wnd) {
                wnd.setOptions({
                    width: winProp.Width,
                    height: winProp.Height,
                    title: winProp.Title
                });

                wnd.refresh({ url: iframeOpenUrl });
                if (globalWindowSender!=null) {
                    kendo.ui.progress(globalWindowSender.sender.element, true);
                }

            } else {
                wnd = $("<div id='" + name + "'></div>").kendoWindow({
                    title: winProp.Title,
                    width: winProp.Width,
                    iframe: true,
                    resizable: true,
                    actions: ["Maximize", "Close"],
                    height: winProp.Height,
                    modal: true,
                    open: OnWindowOpen,
                    activate: OnWindowActivate,
                    close: OnWindowClose,
                    deactivate: OnWindowDeactivate,
                    refresh: OnWindowRefresh,

                    visible: true
                }).data("kendoWindow");
                if (winProp.Position === 'Right') {
                    wnd.wrapper.addClass('k-popup-right');
                }
                else {
                    wnd.center();
                }
                //  RemoveMultipleOverlays();

            }
        }
        function RemoveMultipleOverlays() {
            $('div.k-overlay').remove();
        }
        function CloseWindow(cb) {
            globalCallBack = cb;
            var obj = globalPopups.peek();
            if (obj === null) {
                return null;
            }
            var name = "popup_" + obj.Id;
            var wnd = $("#" + name).data("kendoWindow");
            if (wnd != null) {
                wnd.close();
            }
            return false;
        }
        function GetMainWindow(win) {
            if (win === null || win === undefined) {
                win = window;
            }
            if (win.frameElement === null || win.frameElement === undefined) {
                return win;
            }
            return GetMainWindow(win.parent);
        }
        function GetWindow() {
            var obj = globalPopups.peek();
            if (obj === null) {
                return null;
            }
            var name = "popup_" + obj.Id;
            var windowElement = $("#" + name);
            var iframeDomElement = windowElement.children("iframe")[0];
            var iframeWindowObject = iframeDomElement.contentWindow;
            return iframeWindowObject;
        }
        function GetParentWindow() {
            var obj = globalPopups.peek(1);
            if (obj === null) {
                return window;
            }
            var name = "popup_" + obj.Id;
            var windowElement = $("#" + name);
            var iframeDomElement = windowElement.children("iframe")[0];
            var iframeWindowObject = iframeDomElement.contentWindow;
            return iframeWindowObject;
        }
        function OnWindowActivate(e) {
            var obj = globalPopups.peek();
            console.log(obj)
            if (obj === null) {
                return null;
            }
            var name = "popup_" + obj.Id;
            var wnd = $("#" + name).data("kendoWindow");
            wnd.refresh({
                url: iframeOpenUrl,
                cache: false,
                type: "GET"
            });
            globalWindowSender = e;
            kendo.ui.progress(e.sender.element, true);
        }
        function OnWindowOpen(e) {
        }
        function OnWindowClose(e) {

        }
        function OnWindowRefresh(e) {
            kendo.ui.progress(e.sender.element, false);
        }
        function OnWindowDeactivate(e) {
            var obj = globalPopups.pop();
            if (obj === null) {
                return null;
            }
            var name = "popup_" + obj.Id;
            var wnd = $("#" + name).data("kendoWindow");
            wnd.content("");
            wnd.destroy();
            if (globalCallBack !== null && globalCallBack !== undefined) {
                win = GetWindow();
                if (win === null || win === undefined) {
                    win = window;
                }
                win[globalCallBack.MethodName](globalCallBack.Prms);
                globalCallBack = null;
            }

        }


        var onAjaxBegin = function () {
            ShowLoader($('#main-content'));
        };

        var onAjaxComplete = function () {
            HideLoader($('#main-content'));
        };
        var onAjaxFailed = function (context, res) {
        };
        var iframeOpenUrl = "";
        var iframePageType = "";
        var frm;
        function OnLogout() {
            document.getElementById("logout").submit();
        }
        function OpenChangePassowrd() {
            OpenIframeModal('/account/changepassword', 'Change Password', 350, 700);
        }
        function OpenBreResultViewDetails() {
            OpenIframeModal('/bre/BreResultViewDetails', 'View Details', 450, 700);
        }
    function OpenMyProfile() {
            var myId = '@_userContext.UserId';
            console.log(myId);
            var url = 'user/myprofile?id=' + myId;
            OpenIframeModal(url, 'My Profile', 450, 800);
        }
        function SwitchProfile() {

             var win = GetMainWindow();
            win.iframeOpenUrl =  "/account/switchprofile";
            win.OpenWindow({ Title: 'Switch Profile', Width: 800, Height: 600 });
        return false;
        }
        function OpenGrantAccess() {
            var win = GetMainWindow();
            win.iframeOpenUrl = "/cms/grantAccess/Index";
            win.OpenWindow({ Title: 'Grant Access', Width: 1000, Height: 600 });
            return false;
        }
        function OpenIframeModal(url, title, width, height) {

            ShowLoader($('.modal-body'));
            var iframe = document.createElement('iframe');
            iframe.setAttribute('url', '');
            iframe.setAttribute('frameborder', '0');
            iframe.setAttribute('scrolling', 'no');
            //iframe.setAttribute('width', width);
            //iframe.setAttribute('height', height);
            iframe.onload = function () {
                var h = iframe.contentWindow.document.body.scrollHeight;
                var w = iframe.contentWindow.document.body.scrollWidth;
                iframe.style.height = h + 'px';
                iframe.style.width = w + 'px';
                var mw = eval(w + 30);
                if (width > mw) {
                    mw = width;
                }
                if (height > h) {
                    h = height;
                }
                $('.modal-dialog').css({
                    width: mw + 'px', //probably not needed
                    height: h + 'px', //probably not needed
                    'max-height': '90%'
                });
                HideLoader($('.modal-body'));
            };
            iframe.src = url;
            document.getElementById('iframeDiv').innerHTML = '';
            document.getElementById('iframeDiv').appendChild(iframe);
            //$('#modalIframe').attr('src', '');
            $('#iframeModal').modal({ show: true });
            $('#iframeModal').on('shown.bs.modal', function () {

                $('#modalIframe').attr('src', url);

            })
        };

        function CloseIframeModal(reloadParent) {
            $('#iframeModal').modal('hide');
            if (reloadParent) {
                //window.location.href = window.location.href;
            }
        }
        function ShowLoader(target) {
            target.loadingOverlay();
        }
        function HideLoader(target) {
            target.loadingOverlay('remove');
        }

        function ToggleLoader(target) {
            if (target.hasClass('loading')) {
                target.loadingOverlay('remove');
                //target.loadingOverlay('remove', {
                //    iconClass: 'fa fa-spinner fa-spin'
                //});
            } else {
                target.loadingOverlay();
                //target.loadingOverlay({
                //    iconClass: 'fa fa-spinner fa-spin'
                //});

            };
        }



        function OpenIframePopup(w, h, t) {
            var wnd = $("#kiframepopupwindow").data("kendoWindow");
            wnd.setOptions({
                width: GetW(w),
                height: GetH(h),
                title: t
            });

            wnd.center().open();
            wnd.wrapper.find('.k-window-titlebar').css({
                'background-color': 'transparent',
                'border-bottom-style': 'none',
                'color': 'rgb(193, 151, 42)'
            });
        }
        function CloseIframePopup() {
            var wnd = $("#kiframepopupwindow").data("kendoWindow");
            if (wnd != null) {
                wnd.close();
            }
            return false;
        }
        function GetW(w) {
            return $(window).width() > w ? w : $(window).width() - 30;
        }
        function GetH(h) {
            return $(window).height() > h ? h : $(window).height() - 30;
        }
        function OnIframeActivate(e) {
            e.preventDefault();
            var wnd = $("#kiframepopupwindow").data("kendoWindow");
            ActiveWindow = this;
            wnd.refresh({
                url: iframeOpenUrl,
                cache: false,
                type: "GET"
            });
        }
        function OnIframeOpen(e) {
            kendo.ui.progress(e.sender.element, true);
            //document.body.style.overflow = "hidden";
        }

        function OnIframeClose(e) {
           // document.body.style.overflow = "";
            if (typeof(OnCloseIframePopupPage) !== "undefined") {
                OnCloseIframePopupPage();
            }

            try {
                var pop1 = window.parent.GetIframePopup();
                pop1.PopupClose();
                var url = window.location.href;
                if (url.includes('&documentId')) {
                    window.location.href = url.split('&documentId')[0];
                }
            } catch (x) {

            }
        }
        function OnIframeRefresh(e) {
            kendo.ui.progress(e.sender.element, false);
        }
        function OnIframeDeactivate(e) {
            var wnd = $("#kiframepopupwindow").data("kendoWindow");
            wnd.content("");
        }

        function OpenNtsIframePopup2(w, h, t) {
            var wnd = $("#Ntskiframepopupwindow2").data("kendoWindow");
            wnd.setOptions({
                width: GetW(w),
                height: GetH(h),
                title: t
            });
            //wnd.content(content);
            wnd.center().open();
            wnd.wrapper.find('.k-window-titlebar').css({
                'background-color': 'transparent',
                'border-bottom-style': 'none',
                'color': 'rgb(193, 151, 42)'
            });
        }
        function CloseNtsIframePopup2() {
            var wnd = $("#Ntskiframepopupwindow2").data("kendoWindow");
            if (wnd != null) {
                wnd.close();
            }
            return false;
        }
        function OnNtsIframeActivate2(e) {
            e.preventDefault();
            var wnd = $("#Ntskiframepopupwindow2").data("kendoWindow");
            ActiveWindow = this;
            $.ajax({
                url: iframeOpenUrl,
                type: 'GET',
                cache: false,
                success: function (data) {

                    if (data.msg !== null && data.msg !== undefined && data.msg !== '') {
                        ShowNotification(data.msg, 'success');
                    }
                    if (data.bc !== null && data.bc !== undefined && data.bc !== '') {
                        SetBreadcrumb(data);
                    }
                    if (data.am === true) {
                        SetAccordianMenu(data.page);
                    }
                    if (data.login !== null && data.login !== undefined && data.login !== '') {
                        window.location.href = data.login;
                    }
                    else if (data.viewContent !== null && data.viewContent !== undefined && data.viewContent !== '') {
                        container.html(data.viewContent);
                    }
                    else if (iframePageType === 'Custom') {
                        LoadCustomFormIo(data, container);
                    }

                    else {
                        wnd.content(data.view);
                        var formio = document.getElementById('formio-container');
                        if (formio !== null) {
                            if (iframePageType === 'Page') {
                                LoadPageFormIo(data, formio);
                            }
                            else if (iframePageType === 'Form') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (iframePageType === 'Note') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (iframePageType === 'Task') {
                                LoadTaskFormIo(data, formio);
                            }
                            else if (iframePageType === 'Service') {
                                LoadFormFormIo(data, formio);
                            }
                        }
                    }
                },
                error: function (errData) {
                    container.html(errData);
                    HideLoader(container);
                }
            });

            //wnd.refresh({
            //    content: "123",
            //    cache: false,
            //    type: "GET"
            //});


            //wnd.content(iframeOpenUrl);
            //return false;
        }
        function OnNtsIframeOpen2(e) {
            kendo.ui.progress(e.sender.element, true);
            //document.body.style.overflow = "hidden";
        }

        function OnNtsIframeClose2(e) {
            if (globalNtsPopupCallbackMethod != null) {
                window[globalNtsPopupCallbackMethod](globalNtsPopupCallbackMethodParam);
                globalNtsPopupCallbackMethod = null;
                globalNtsPopupCallbackMethodParam = null;
            }


        }
        function OnNtsIframeRefresh2(e) {
            kendo.ui.progress(e.sender.element, false);
        }
        function OnNtsIframeDeactivate2(e) {
            var wnd = $("#Ntskiframepopupwindow2").data("kendoWindow");
            wnd.content("");
        }


        function OpenNtsIframePopup(w, h, t) {
            var wnd = $("#Ntskiframepopupwindow").data("kendoWindow");
            wnd.setOptions({
                width: GetW(w),
                height: GetH(h),
                title: t
            });
            //wnd.content(content);
            wnd.center().open();
            wnd.wrapper.find('.k-window-titlebar').css({
                'background-color': 'transparent',
                'border-bottom-style': 'none',
                'color': 'rgb(193, 151, 42)'
            });
        }
        function CloseNtsIframePopup() {
            var wnd = $("#Ntskiframepopupwindow").data("kendoWindow");
            if (wnd != null) {
                wnd.close();
            }
            return false;
        }

        function OnNtsIframeActivate(e) {
            e.preventDefault();
            var wnd = $("#Ntskiframepopupwindow").data("kendoWindow");
            ActiveWindow = this;
            $.ajax({
                url: iframeOpenUrl,
                type: 'GET',
                cache: false,
                success: function (data) {
                    if (data.msg !== null && data.msg !== undefined && data.msg !== '') {
                        ShowNotification(data.msg, 'success');
                    }
                    if (data.bc !== null && data.bc !== undefined && data.bc !== '') {
                        SetBreadcrumb(data);
                    }
                    if (data.am === true) {
                        SetAccordianMenu(data.page);
                    }
                    if (data.login !== null && data.login !== undefined && data.login !== '') {
                        window.location.href = data.login;
                    }
                    else if (data.viewContent !== null && data.viewContent !== undefined && data.viewContent !== '') {
                        container.html(data.viewContent);
                    }
                    else if (iframePageType === 'Custom') {
                        LoadCustomFormIo(data, container);
                    }
                    else {
                        wnd.content(data.view);
                        var formio = document.getElementById('formio-container');
                        if (formio !== null) {
                            if (iframePageType === 'Page') {
                                LoadPageFormIo(data, formio);
                            }
                            else if (iframePageType === 'Form') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (iframePageType === 'Note') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (iframePageType === 'Task') {
                                LoadTaskFormIo(data, formio);
                            }
                            else if (iframePageType === 'Service') {
                                LoadFormFormIo(data, formio);
                            }
                        }
                    }
                },
                error: function (errData) {
                    container.html(errData);
                    HideLoader(container);
                }
            });

            //wnd.refresh({
            //    content: "123",
            //    cache: false,
            //    type: "GET"
            //});


            //wnd.content(iframeOpenUrl);
            //return false;
        }
        function OnNtsIframeOpen(e) {
            kendo.ui.progress(e.sender.element, true);
            //document.body.style.overflow = "hidden";
        }
        var globalNtsPopupCallbackMethod;
        var globalNtsPopupCallbackMethodParam;
        function OnNtsIframeClose(e) {
            if (globalNtsPopupCallbackMethod != null) {
                window[globalNtsPopupCallbackMethod](globalNtsPopupCallbackMethodParam);
                globalNtsPopupCallbackMethod = null;
                globalNtsPopupCallbackMethodParam = null;
            }


        }
        function OnNtsIframeRefresh(e) {
            kendo.ui.progress(e.sender.element, false);
        }
        function OnNtsIframeDeactivate(e) {
            var wnd = $("#Ntskiframepopupwindow").data("kendoWindow");
            wnd.content("");
        }



        function OnIframeClose2(e) {
            try {
                var pop2 = window.parent.GetIframePopup();
                pop2.PopupClose2();
            } catch (x) {

            }
        }
        function OpenIframePopup2(w, h, t) {
            var wnd = $("#kiframepopupwindow2").data("kendoWindow");
            wnd.setOptions({
                width: GetW(w),
                height: GetH(h),
                title: t
            });
            wnd.center().open();
            wnd.wrapper.find('.k-window-titlebar').css({
                'background-color': 'transparent',
                'border-bottom-style': 'none',
                'color': 'rgb(193, 151, 42)'
            });

        }
        function CloseIframePopup2() {
            var wnd = $("#kiframepopupwindow2").data("kendoWindow");
            if (wnd != null) {
                wnd.close();
            }
            return false;
        }
        function OnIframeActivate2(e) {
            e.preventDefault();
            var wnd = $("#kiframepopupwindow2").data("kendoWindow");
            ActiveWindow = this;
            wnd.refresh({
                url: iframeOpenUrl,
                cache: false,
                type: "GET"
            });
        }
        function OnIframeOpen2(e) {
            kendo.ui.progress(e.sender.element, true);
        }
        function OnIframeRefresh2(e) {
            kendo.ui.progress(e.sender.element, false);
        }
        function OnIframeDeactivate2(e) {
            var wnd = $("#kiframepopupwindow2").data("kendoWindow");
            wnd.content("");
        }
        function GetIframePopup2() {
            var windowElement = $("#kiframepopupwindow2");
            var iframeDomElement = windowElement.children("iframe")[0];
            var iframeWindowObject = iframeDomElement.contentWindow;
            return iframeWindowObject;
        }
        function GetNtsIframePopup() {
            var windowElement = $("#Ntskiframepopupwindow");
            var iframeDomElement = windowElement.children("iframe")[0];
            var iframeWindowObject = iframeDomElement.contentWindow;
            return iframeWindowObject;
        }

        function GetNtsIframePopup2() {
            var windowElement = $("#Ntskiframepopupwindow2");
            var iframeDomElement = windowElement.children("iframe")[0];
            var iframeWindowObject = iframeDomElement.contentWindow;
            return iframeWindowObject;
        }

        function PhotoError(obj) {
            obj.onerror = null;
            obj.src = '/images/profile.jpg';

        };
        function LogoError(obj) {
            //console.log($(obj).parent());
         // obj.src = '/images/logo.png';
            //$(obj).parent().css('padding-top', '15px');
            //$(obj).parent().css('padding-left', '0px');
            obj.onerror = null;
            $(obj).hide();


        };
        function OnPhotoError(obj) {
            obj.onerror = null;
            obj.src = '/images/profile.jpg';
        }
        var userPopoverSettings = {
            width: 210,//https://github.com/sandywalker/webui-popover
            height: 250,
            trigger: 'hover',
            placement: 'auto',//values: auto,top,right,bottom,left,top-right,top-left,bottom-right,bottom-left,auto-top,auto-right,auto-bottom,auto-left,horizontal,vertical
            delay: {//show and hide delay time of the popover, works only when trigger is 'hover',the value can be number or object
                show: null,
                hide: 300
            },
            async: {
                type: 'GET', // ajax request method type, default is GET
                before: function (that, xhr, settings) { settings.url = settings.url.replace('{}', that.$element.data('user-id')); this.content = null; },//executed before ajax request
                success: function (that, data) { HideLoader($('.webui-popover-content')); },//executed after successful ajax request
                error: function (that, xhr, data) { HideLoader($('.webui-popover-content'));} //executed after error ajax request
            },
            cache: false,//if cache is set to false,popover will destroy and recreate
            multi: false,//allow other popovers in page at same time
            arrow: true,//show arrow or not
            title: '',//the popover title, if title is set to empty string,title bar will auto hide
            content: function (data) {
                var html = '<div style="text-align:center;"><img id="o-img" class="user-photo-large rounded-circle" src="/Cms/document/getimagemongo/' + data.PhotoId + '" onerror="OnPhotoError(this);"></div>'
                    + '<div style="text-align:center;font-size:13px;color:#606060;" class="pt-3"><i class="fa fa-user"></i><span class="pl-2">' + data.Name + '</span></div>'
                    + '<div style="text-align:center;font-size:13px;color:#606060;"><i class="fa fa-envelope"></i><span class="pl-2">' + data.Email + '</span></div>';
                if (data.JobTitle !== null) {
                    html += '<div style="text-align:center;font-size:13px;color:#606060;"><i class="fa fa-user-tie"></i><span class="pl-2">' + data.JobTitle + '</span></div>';
                }
                if (data.Mobile !== null) {
                    html += '<div style="text-align:center;font-size:13px;color:#606060;"><i class="fa fa-mobile"></i><span class="pl-2">' + data.Mobile + '</span></div>';
                }
                return html;
            },
            onShow: function ($element) { ShowLoader($('.webui-popover-content')); },
            closeable: false,//display close button or not
            ///padding: true,//content padding
            type: 'async',//content type, values:'html','iframe','async'
            url: '/cms/User/GetUser?userId={}',//if type equals 'html', value should be jQuery selecor.  if type equels 'async' the plugin will load content by url.
            //backdrop: true,//if backdrop is set to true, popover will use backdrop on open
            // dismissible: true // if popover can be dismissed by  outside click or escape key

        };

        function OnLegalChange(e) {
            var email = '@_userContext.Email';
            var legalId = this.value();
            var portalId = $('#GlobalPortalId').val();
            $.ajax({
                type: 'POST',
                url: "/Account/ChangeContext?email=" + email + "&legalEntityId=" + legalId + "&PortalId=" + portalId,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (res) {

                    window.location.href = window.location.href;
                }
            });
        }
             function OnMenuLegalChange(legalId) {
            var email = '@_userContext.Email';
            var portalId = $('#GlobalPortalId').val();
            $.ajax({
                type: 'POST',
                url: "/Account/ChangeContext?email=" + email + "&legalEntityId=" + legalId + "&PortalId=" + portalId,
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (res) {

                    window.location.href = window.location.href;
                }
            });
        }
           function OnMenuPortalChange(portalId) {
            var email = '@_userContext.Email';
            $.ajax({
                type: 'POST',
                url: "/Account/SwitchPortal",
                data: { SwitchPortalId: portalId },
               // dataType: 'json',
                success: function (res) {
                    OnSwitchPortalRefresh(res.portal);
                }
            });
        }

    </script>

</head>


<body>

    <input type="hidden" id="GlobalPortalId" />
    <input type="hidden" id="GlobalHRDirectUserId" />
    <input type="hidden" id="GlobalHRDirectPersonId" />
    <input type="hidden" id="GlobalHRDirectPositionId" />
    <input type="hidden" id="GlobalHRDirectDepartmentId" />
    <input type="hidden" id="GlobalHRDirectJobId" />
    <!-- container section start -->
    <section id="container">

        <div class="hide-in-popup header row no-gutters " style="background-color:white;height:@(bannerHeight)px;border-bottom:solid;border-bottom-width:thin;border-bottom-color: #C4C4C4;">
            <div class="col-md-2 row no-gutters">

                <div class="col-3 toggle-nav" style="color:#fff;">
                    <div class="dropdown">
                        <button class="hamburger-menu primary-border navbar-toggler" type="button" data-toggle="dropdown"
                                aria-haspopup="true" aria-expanded="false">
                            <span class="primary-font-color">
                                <i class="fas fa-bars" style="font-size:24px;"></i>
                            </span>
                        </button>
                        @{

                            var menus = (List<CMS.UI.ViewModel.MenuViewModel>)ViewBag.Menus;
                            var ht = 575;
                            var mgh = 120;
                            var mh = 38;
                            if (menus != null)
                            {
                                var mg = menus.Where(x => x.PageType == TemplateTypeEnum.MenuGroup).Count() * mgh;
                                var p = menus.Where(x => x.PageType != TemplateTypeEnum.MenuGroup).Count() * mh;
                                var required = mg + p;
                                menuWidth = ((required / 575) + 1) * 300;
                            }
                            @:<div id="main-menu" class="dropdown-menu menu-container">
                                void LoadAccordianMenu(CMS.UI.ViewModel.MenuViewModel menu, CMS.UI.ViewModel.MenuParam prm, int menuNo, int level)
                                {
                                    if (menu.PageType == TemplateTypeEnum.MenuGroup)
                                    {
                                        prm.Height += mgh;
                                        if (prm.Height >= ht)
                                        {
                                            prm.ColumnCount++;
                                            prm.Height = mgh;
                                            prm.Html += $"</div><div class='menu-col col-color-{prm.ColumnCount}'>";

                                        }
                                        prm.Html += $"<a class=\"inode-link-nocss\" href=\"javascript:LoadPageById('{menu.Id}','{CMS.Common.TemplateTypeEnum.MenuGroup}','{CMS.Common.RequestSourceEnum.Main.ToString()}','{CMS.Common.DataActionEnum.None.ToString()}')\" >";

                                        prm.Html += $"<div class='row no-gutters menu-group col-color-{menuNo}-{level} col-level-{level}'>";
                                        prm.Html += $"<div class='col-5'><img class='menu-accordion-img' src='/cms/document/getimagemongo/{menu.IconFileId}' alt='Menu image' onerror='OnDocumentError(this);'></div>";
                                        prm.Html += $"<div class='col-7 menu-group-text'>{menu.DisplayName}</div>";
                                        prm.Html += $"</div>";
                                        prm.Html += $"</a>";
                                    }


                                    var childs = menus.Where(x => x.ParentId == menu.Id && x.PageType != TemplateTypeEnum.MenuGroup);
                                    if (childs != null && childs.Any())
                                    {
                                        foreach (var item in childs.OrderBy(x => x.SequenceOrder))
                                        {
                                            prm.Height += mh;
                                            if (prm.Height >= ht)
                                            {
                                                prm.ColumnCount++;
                                                prm.Height = mh;
                                                prm.Html += $"</div><div class='menu-col col-color-{prm.ColumnCount}'>";
                                            }

                                            prm.Html += $"<a class='' href=\"javascript:LoadPageById('{item.Id}','{item.PageType.ToString()}','{CMS.Common.RequestSourceEnum.Main.ToString()}','{CMS.Common.DataActionEnum.None.ToString()}')\">";
                                            prm.Html += $"<div class='menu-item col-color-{menuNo}-{level} col-level-{level}'>";
                                            prm.Html += $"<i class=\"{item.IconCss} menu-item-icon\"></i>";
                                            prm.Html += $"<span class=\"menu-item-text\">{item.DisplayName}</span>";
                                            prm.Html += $"</div>";
                                            prm.Html += $"</a>";

                                        }
                                    }

                                    var subMenuGroups = menus.Where(x => x.ParentId == menu.Id && x.PageType == TemplateTypeEnum.MenuGroup);
                                    if (subMenuGroups != null && subMenuGroups.Any())
                                    {

                                        @foreach (var sub in subMenuGroups.OrderBy(x => x.SequenceOrder))
                                        {
                                            LoadAccordianMenu(sub, prm, menuNo, level + 1);
                                        }

                                    }

                                }

                                if (menus != null)
                                {
                                    var menuNo = 1;
                                    var prm = new CMS.UI.ViewModel.MenuParam { Html = "<div class='menu-col col-color-1'>", Height = 0, ColumnCount = 1 };
                                    //foreach (var menu in menus.Where(x => x.ParentId == x.PortalId && menus.Any(y => y.ParentId == x.Id)).OrderBy(x => x.SequenceOrder))
                                    foreach (var menu in menus.Where(x => x.ParentId == x.PortalId && x.PageType == TemplateTypeEnum.MenuGroup && menus.Any(y => y.ParentId == x.Id)).OrderBy(x => x.SequenceOrder))
                                    {
                                        LoadAccordianMenu(menu, prm, menuNo++, 0);
                                    }
                                    prm.Html += "</div>";
                                    @Html.Raw(prm.Html);
                                }




                            @:</div>
                        }
                    </div>

                </div>
                <div class="col-9">

                    @if (ViewBag.Portal != null)
                    {
                        if (ViewBag.Portal.LogoId != "null")
                        {
                            <a href="@ViewBag.Portal?.LandingPage" class="logo"><img alt="" title="" style="max-height:@(bannerHeight)px;" src="@Url.Action("getimagemongo","document",new { @area="Cms",id=ViewBag.Portal.LogoId})" onerror='LogoError(this);' /></a> }
                        else
                        {
                            <a href="@ViewBag.Portal?.LandingPage" class="app-name">@ViewBag.Portal.DisplayName</a>
                        }
                    }

                </div>
            </div>
            <div class="col-md-4">
                @*@if (ViewBag.Portal.BannerId != "null")
                    {
                        <img alt="" style="height:@(bannerHeight)px;" class="banner-img" title="" src="@Url.Action("getimage","document",new { @area="Cms",id=ViewBag.Portal.BannerId})" onerror='LogoError(this);' />
                    }*@
                @if (ViewBag.EnableMultiLanguage == true)
                {
                    <div class="float-right pt-4">
                        <span onclick="return ChangeLanguage('ar-SA');" class="lng-item pr-2 @(_userContext.CultureName=="ar-SA"?"lng-active":"")" style="font-size:16px">العربية</span>|<span onclick="return ChangeLanguage('en-US');" class="lng-item pl-2 @(_userContext.CultureName=="en-US"?"lng-active":"")" style="font-size:14px">English</span>
                    </div>
                }

            </div>

            <div class="col-md-6 row no-gutters user-menu">
                <div class="col-9 logindetail">
                    <img class="user-img rounded-circle float-right user-context-menu" style="padding-top:2px;margin-right:0px;" id="profileImg" src="@Url.Action("getimagemongo","document",new { @area="Cms",id=_userContext.PhotoId})" onerror='OnPhotoError(this);' />
                    @if (_userContext.UserId != _userContext.LoggedInAsByUserId)
                    {
                        <p class="text-light cms-user-name float-right" style="font-size:14px;padding-top:1px;padding-right:10px"> <span>Logged in as </span>@_userContext.Name <br /><span>by </span><span>@_userContext.LoggedInAsByUserName </span></p>

                    }
                    else
                    {
                        <p class="text-light cms-user-name float-right" style="padding-top:10px;padding-right:10px">@_userContext.Name</p>
                    }
                    <span style="margin-left:18px">
                        @if (_userContext.UserPortals.IndexOf(",") > 0)
                        {
                            @(Html.Kendo().DropDownList().Name("drpPortal")
                        .DataTextField("Name").Value(viewBagPortalId)
                        .DataValueField("Id")
                        .OptionLabel("Portal")
                        .Events(e => e.Change("OnPortalChange"))
                        .DataSource(source =>
                        {
                            source.Read(read =>
                            {
                                read.Action("GetPortalList", "User", new { @area = "Cms", userId = _userContext.UserId });
                            });
                        })

                        .HtmlAttributes(new { @class = "userlegal", style = "width:30%;" })
                    )
                        }
                    </span>
                    <span style="margin-left:18px">
                        @(Html.Kendo().DropDownList().Name("LegalEntity")
          .DataTextField("Name").Value(Convert.ToString(_userContext.LegalEntityId))
                    .DataValueField("Id")
                     .OptionLabel("Legal Entity")
        .Events(e => e.Change("OnLegalChange"))
       .DataSource(source =>
       {
           source.Read(read =>
           {
               read.Action("GetLegalEntitiesList", "User", new { @area = "Cms",userId=_userContext.UserId });
           });
       })

          .HtmlAttributes(new { @class = "userlegal", style = "width:30%;" })
    )
                    </span>

                </div>

                <div class="col-3 p-1 pr-4 mt-2" style="margin-top: -2.2rem!important;padding-left: 2.5rem !important;">
                    <div style="width: 50px; cursor: pointer;" onclick="openWinNavigateUrl(); return false;">
                        <i class="far fa-bell" style="color:red;font-size:26px;" id="ImageButton1"></i>
                        <p id="notcount" runat="server" class="badge badge-light" style="padding-top:5px; background-color:orangered;color:#fff;margin-top:-10px;margin-left:-3px;position:absolute;">0</p>
                    </div>
                </div>

            </div>
        </div>

        <!-- sidebar menu end-->
        <!--</div>
        </aside>-->
        <!--sidebar end-->
        <!--main content start-->

        <section id="main-content" class="clear-padding col-sm-12 col-md-12 mx-auto" style="padding-bottom:30px;padding-top:@(bannerHeight)px;">
            @RenderSection("rb", required: false)

            @RenderBody()
        </section>
        <!--main content end-->
        @if (footerText.IsNotNullAndNotEmpty())
        {
            <div class="hide-in-popup div-footer text-center" style="padding-top:8px;padding-bottom:10px;">
                <div class="credits">
                    <span>@Html.Raw(footerText)</span>
                </div>
            </div>
        }
    </section>
    <!-- container section end -->
    <!-- javascripts -->
    @*<form method="post" action="~/Identity/Account/LogOut" id="logout" style="display:none;">
            <button type="submit" class="nav-link btn btn-link">Log out</button>
        </form>*@
    <!-- Logout Modal-->
    <div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <form class="form-inline" asp-area="" asp-controller="Account" asp-action="Logout" method="post" asp-route-returnUrl="@returnUrl">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title" id="exampleModalLabel">@SharedResource["ConfirmLogoutHeader"]</h6>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">@SharedResource["ConfirmLogoutText"]</div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">@SharedResource["Cancel"]</button>
                        <button class="btn btn-primary" type="submit">@SharedResource["Logout"]</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <div class="modal fade" id="languageModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
         aria-hidden="true">
        <form asp-controller="Account" asp-action="ChangeLanguage" asp-area="" method="post"
              data-ajax-success="onAjaxSuccessChangeLanguage"
              data-ajax="true" data-ajax-method="POST">
            <input type="hidden" name="hdnLang" value="en-US" id="hdnLang" />
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h6 class="modal-title" id="exampleModalLabel">@SharedResource["ConfirmLanguageChangeTitle"]</h6>
                        <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">×</span>
                        </button>
                    </div>
                    <div class="modal-body">@SharedResource["ConfirmLanguageChangeText"]</div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" type="button" data-dismiss="modal">@SharedResource["No"]</button>
                        <button class="btn btn-primary" type="submit">@SharedResource["YesProceed"]</button>
                    </div>
                </div>
            </div>
        </form>
    </div>
    <!-- Iframe Modal-->

    <div class="modal fade" id="iframeModal" tabindex="-1" role="dialog" aria-labelledby="iframeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="iframeModalLabel">Title</h5>
                    <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="loading-overlay">
                        <p class="loading-spinner">
                            <span class="loading-icon fa fa-spinner fa-spin fa-2x"></span>
                            <span class="loading-text"></span>
                        </p>
                    </div>
                    <div id="iframeDiv"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- Iframe Window-->
    @(Html.Kendo().Window().Name("kiframepopupwindow")
        .Title("Window_TitlePopupWindow")
        .Visible(false)

        .Modal(true)
        .Iframe(true)
        //.ContentSettings(x => x.Cache(false))
        .Draggable(true)
        .Content("")
.Actions(actions => actions.Maximize().Close())

.Width(200)
.Height(350)
.Events(e => e.Activate("OnIframeActivate").Open("OnIframeOpen").Close("OnIframeClose").Refresh("OnIframeRefresh").Deactivate("OnIframeDeactivate"))
    )
    @(Html.Kendo().Window().Name("Ntskiframepopupwindow")
        .Title("Window")
        .Visible(false)

        .Modal(true)
        //.Iframe(true)
        //.ContentSettings(x => x.Cache(false))
        .Draggable(true)
        .Content("")
.Actions(actions => actions.Maximize().Close())

.Width(200)
.Height(350)
.Events(e => e.Activate("OnNtsIframeActivate").Open("OnNtsIframeOpen").Close("OnNtsIframeClose").Refresh("OnNtsIframeRefresh").Deactivate("OnNtsIframeDeactivate"))
    )
    @(Html.Kendo().Window().Name("Ntskiframepopupwindow2")
        .Title("Window")
        .Visible(false)

        .Modal(true)
        //.Iframe(true)
        //.ContentSettings(x => x.Cache(false))
        .Draggable(true)
        .Content("")
.Actions(actions => actions.Maximize().Close())

.Width(200)
.Height(350)
.Events(e => e.Activate("OnNtsIframeActivate2").Open("OnNtsIframeOpen2").Close("OnNtsIframeClose2").Refresh("OnNtsIframeRefresh2").Deactivate("OnNtsIframeDeactivate2"))
    )
    @(Html.Kendo().Window().Name("kiframepopupwindow2")
        .Title("Window_TitlePopupWindow")
        .Visible(false)
        .Modal(true)
        .Iframe(true)
        //.ContentSettings(x => x.Cache(false))
        .Draggable(true)
        .Content("")

        .Width(200)
.Height(350)
.Actions(actions => actions.Maximize().Close())
.Events(e => e.Activate("OnIframeActivate2").Open("OnIframeOpen2").Close("OnIframeClose2").Refresh("OnIframeRefresh2").Deactivate("OnIframeDeactivate2"))
    )
    <span id="popupNotification"></span>


    <link rel='stylesheet' href='https://cdn.form.io/formiojs/formio.full.min.css'>

    <script src="~/js/popper.min.js" asp-append-version="true"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.min.js" asp-append-version="true"></script>

    <script src="~/lib/jquery-easing/jquery.easing.min.js" asp-append-version="true"></script>
    <script src="~/js/layout.js" asp-append-version="true"></script>


    <script src="~/lib/loading-overlay/loading-overlay.min.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-context-menu/dist/jquery.contextMenu.min.js" asp-append-version="true"></script>
    <script src="~/lib/jquery-context-menu/dist/jquery.ui.position.min.js" asp-append-version="true"></script>
    <link rel="stylesheet" href="~/lib/jquery-context-menu/dist/jquery.contextMenu.min.css" asp-append-version="true">


    <script src="~/Themes/HR/js/jquery.nicescroll.js" type="text/javascript" asp-append-version="true"></script>

    <script src="~/Themes/HR/js/scripts.js" asp-append-version="true"></script>

    <script src="~/lib/formio/js/formio.full.js" asp-append-version="true"></script>


    @RenderSection("scripts", required: false)
    <script>
      function OnPortalChange(e) {
            var email = '@_userContext.Email';
          var portalId = this.value();
          if (portalId === '' || portalId === undefined || portalId === null) {
              portalId = '@viewBagPortalId';
          }
            $.ajax({
                type: 'POST',
               // url: "/Account/ChangeContext?email=" + email + "&PortalId=" + portalId,
                url: "/Account/SwitchPortal",
               // contentType: 'application/json; charset=utf-8',
                data: { SwitchPortalId: portalId },
               // dataType: 'json',
                success: function (res) {
                    OnSwitchPortalRefresh(res.portal);
                }
            });
        }
        function RefreshNotification() {
            GethNotificationCount();
            var interval = setInterval(function () {
                GethNotificationCount();
            }, 30 * 1000);

        };
        function GethNotificationCount() {
            $("#ImageButton1").removeClass('wiggle1');
            $.ajax({
                url: "/cms/GetUnreadNotificationCount",
                contentType: "application/json",
                cache: false,
                success: function (result) {
                    var count = $('#notcount').html();
                    if (eval(result.UnReadCount) >= eval(count) ) {
                        $('#ImageButton1').addClass('wiggle1');
                    }
                    if (result.UnReadCount >= 0) {
                        $('#notcount').html(result.UnReadCount);
                    }
                },
                error: function (xhr, textStatus, errorThrown) {

                }
            });

        }
        function openWinNavigateUrl() {
            var win = GetMainWindow();
            win.iframeOpenUrl = '@Url.Action("NotificationIndex", "NotificationTemplate", new { @area= "PortalAdmin" })?lo=@LayoutModeEnum.Popup';
            win.OpenWindow({ Title: 'Notifications', Width: 1200, Height: 1100 });

            return false;

        }
        $(document).ready(function () {
            var wdth =@menuWidth+3;
            if (wdth > screen.width) {
                wdth = screen.width - 50;
            }
            document.getElementById("main-menu").style.width = wdth + 'px';
       var url = '@Url.Action("Page", "Cms")?';
        var pageUrl = '@Html.Raw(ViewBag.PageUrl)';
        var customUrl = '@Html.Raw(ViewBag.CustomUrl)';
        @if (ViewBag.Portal != null && ViewBag.Portal.Id != null)
        {
           @: $('#GlobalPortalId').val('@ViewBag.Portal.Id');
        }
        if (pageUrl !== '') {
            url += '&' + pageUrl;
        }
        if (customUrl !== '') {
            url += '&customUrl=' + encodeURIComponent( customUrl);
        }
        LoadCmsPartialView(url, '@ViewBag.PageType');
            RefreshNotification();
            $('.hamburger-menu').on('mouseup', function (event) {
                $('.contextMenu').hide();
                $('.context-menu-list').trigger('contextmenu:hide');
            });
    });
        function ShowLoader(target) {
            kendo.ui.progress(target, true);
        }
        function HideLoader(target) {
            kendo.ui.progress(target, false);
        }
        function LoadPageFormIo(data, formio) {
            var ui = JSON.parse(data.uiJson);
            Formio.createForm(formio, ui).then(function (form) {
                form.submission = {
                    data: data.dataJson
                };
            });
        }
        function LoadFormIo(data, formio) {
            var ui = JSON.parse(data.uiJson);
            var dataJ = JSON.parse(data.dataJson);
            Formio.createForm(formio, ui).then(function (form) {
                frm = form;
                form.submission = { data: dataJ };
            });
        }
        function LoadFormFormIo(data, formio) {
            return false;
            var ui = JSON.parse(data.uiJson);
            var dataJ = JSON.parse(data.dataJson);
            Formio.createForm(formio, ui).then(function (form) {
                frm = form;
                form.submission = {
                    data: dataJ
                };
            });
    }
        function LoadTaskFormIo(data, formio) {
            return false;
        var ui = JSON.parse(data.uiJson);
        var dataJ = JSON.parse(data.dataJson);
        Formio.createForm(formio, ui).then(function (form) {
            frm = form;
            form.submission = {
                data: dataJ
            };
        });

        }
        //function LoadMenuGroup(data, container) {
        //    container.html(data.view);
        //}
    function LoadCustomFormIo(data, container) {
        var portalId = $('#GlobalPortalId').val();
            var url = "";
            if (data.dataJson.AreaName!==null) {
                url += "/" + data.dataJson.AreaName;
            }
            if (data.dataJson.ControllerName !== null) {
                url += "/" + data.dataJson.ControllerName;
            }
            if (data.dataJson.ActionName !== null) {
                url += "/" + data.dataJson.ActionName;
            }
            if (data.customUrl !== null) {

                url += "?" + data.customUrl + "&pageId=" + data.dataJson.PageId + "&portalId=" + portalId ;
                if (data.page !== null && data.page != 'undefined' && data.page != undefined) {
                    url += '&permissions=' + data.page.PermissionsText + '&pageName=' + data.page.Name;
                }
                if (data.dataJson.Parameter !== null) {
                    url += "&" + data.dataJson.Parameter;
                }
            }
            else {
                if (data.dataJson.CustomTemplateLoadingType === 1) {
                    url = window[data.dataJson.JavascriptName](data.dataJson.JavascriptParam);

                }
                url += "?pageId=" + data.dataJson.PageId + "&portalId=" + portalId ;
                if (data.page !== null && data.page != 'undefined' && data.page != undefined) {
                    url += '&permissions=' + data.page.PermissionsText + '&pageName=' + data.page.Name;
                }
                if (data.dataJson.Parameter !== null) {
                    url += "&" + data.dataJson.Parameter;
                }
                if ('@ViewBag.Prms' != '') {
                    url += "&@ViewBag.Prms";
                }
            }
            container.load(url, function () {
            });
        }
        function OpenLogout() {
            $('#logoutModal').show();
        }
        function OnHrDirectLoad(param) {
            var userId = $('#GlobalHRDirectUserId').val();
            var personId = $('#GlobalHRDirectPersonId').val();
            var positionId = $('#GlobalHRDirectPositionId').val();
            return '/chr/hrdirect/homepage?jsMethod=' + param + '&userId=' + userId + '&personId=' + personId + '&positionId=' + positionId;
        }
    function OnAccordianMenuClick(e,id, pageType, source, dataAction) {
        LoadPageById(id, pageType, source, dataAction);
        }
        function GetSortOrder(prop) {
            return function (a, b) {
                if (a[prop] > b[prop]) {
                    return 1;
                } else if (a[prop] < b[prop]) {
                    return -1;
                }
                return 0;
            }
        }

        function GetMenuCount(menu, menus0) {
            var count = 38;
            if (menu.PageType===15) {
                count = 120;
            }
            var childs = menus0.filter(x => x.ParentId == menu.Id);
            if (childs !== null || childs.length > 0) {
                $.each(childs, function (key, value) {
                    count += GetMenuCount(value, menus0);
                });
            }
            return count;
        }
        var ht = 400;
        var mgh = 120;
        var mh = 38;
        var menuWidth = 300;
    function LoadAccordianMenu(menu, menus0, prm,  menuNo,   level) {
            var templateTypeEnum = JSON.parse('@Html.Raw(EnumExtension.EnumToJson(typeof(CMS.Common.TemplateTypeEnum)))');
            var pageType = templateTypeEnum[menu.PageType];
            if (pageType =='@TemplateTypeEnum.MenuGroup.ToString()') {
                var mg = menus0.filter(x => x.PageType == 15).length * mgh;
                var p = menus0.filter(x => x.PageType != 15).length * mh;
                var required = mg + p;
                menuWidth = ((required / ht) + 1) * 300;
                prm.Height += mgh;
                if (prm.Height >= ht) {
                    prm.ColumnCount++;
                    prm.Height = mgh;
                    prm.Html +=  "</div><div class='menu-col col-color-"+prm.ColumnCount+"'>";

                }
                prm.Html +=  "<a class=\"inode-link-nocss\" href=\"javascript:LoadPageById('"+menu.Id+"','MenuGroup','Main','None')\" >";

                prm.Html +=  "<div class='row no-gutters menu-group col-color-" + menuNo +"-"+level+" col-level-"+level+"'>";
                prm.Html +=  "<div class='col-5'><img class='menu-accordion-img' src='/cms/document/getimagemongo/"+menu.IconFileId+"' alt='Menu image' onerror='OnDocumentError(this);'></div>";
                prm.Html +=  "<div class='col-7 menu-group-text'>"+menu.DisplayName+"</div>";
                prm.Html +=  "</div>";
                prm.Html +=  "</a>";
        }
        var childs = menus0.filter(x => x.ParentId === menu.Id && x.PageType !== 15);
        if(childs !== null || childs.length > 0) {
            childs.sort(GetSortOrder("SequenceOrder"));
            $.each(childs, function (key, item) {
                prm.Height += mh;
                if (prm.Height >= ht) {
                    prm.ColumnCount++;
                    prm.Height = mh;
                    prm.Html +=  "</div><div class='menu-col col-color-"+prm.ColumnCount+"'>";
                }
                prm.Html += "<a class='' href=\"javascript:LoadPageById('" + item.Id + "','" + templateTypeEnum[item.PageType] + "','Main','None')\">";
                prm.Html +=  "<div class='menu-item col-color-"+menuNo+"-"+level+" col-level-"+level+"'>";
                prm.Html +=  "<i class=\""+item.IconCss+" menu-item-icon\"></i>";
                prm.Html +=  "<span class=\"menu-item-text\">"+item.DisplayName+"</span>";
                prm.Html += "</div>";
                prm.Html += "</a>";
            });
        }
        var subMenuGroups = menus0.filter(x => x.ParentId == menu.Id && x.PageType == 15);
        if (subMenuGroups !== null && subMenuGroups.length > 0) {
            $.each(subMenuGroups, function (key, value) {
                prm = LoadAccordianMenu(value, menus0, prm, menuNo, level + 1);
                //prm.Html += ret.Html;
            });
        }
        return prm;
        }
    function SetAccordianMenu(page) {
        var menus0 = page.Menus;
        $('#layout-am').html('');
        var accordians = GetStack();
        var item = menus0.find(x => x.Id === page.Id);
        while (item != null && item !== undefined) {
            accordians.push(item);
            item = menus0.find(x => x.Id == item.ParentId);
        }
        var html = "";
        if (accordians.isEmpty() === false) {
            html += '<div class="accordion menu-accordion" id="menu-accordion">';
            while (accordians.isEmpty() === false) {
                var menu0 = accordians.pop();
                var finalaccordian = "";
                var finalaccordianMenu = "";
                if (accordians.isEmpty() === false) {
                    finalaccordian = "final-accordian";
                    finalaccordianMenu = "final-accordian-menu";
                }
                html += '<div class="accordion-group ' + (finalaccordian === "" ? "" : finalaccordian)+'">\
                            <div class="accordion-heading" data-toggle="collapse" data-target="#collapse'+menu0.Id+'" data-parent="#menu-accordion">\
                                <div class="accordion-toggle" dataToStringle="collapse" data-parent="#menu-accordion" data-target="#collapse'+menu0.Id+'">';
                var child = menus0.find(x => x.ParentId == menu0.Id);
                if (child !== null && child !== undefined) {
                    var required = GetMenuCount(menu0, menus0);
                    var wt = ((Math.floor((required / ht)) + 1) * 300) + 3;
                    if (wt > screen.width) {
                        wt = screen.width - 50;
            }

                                        html += '<span class="dropdown">\
                                            <button class="accordion-button hamburger-menu navbar-toggler" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >\
                                                <span class="dark-blue-text">\
                                                    <i class="fas fa-bars" style="font-size:20px;"></i>\
                                                </span>\
                                             </button >\
                                            <div class="dropdown-menu sub-menu-container ' + (finalaccordianMenu === "" ? "" : finalaccordianMenu) +'" style="height:'+ht+'px;width:'+wt+'px;overflow-y:auto;">';
                    html += LoadAccordianMenu(menu0, menus0, { Html: "<div class='menu-col col-color-1'>", Height: 0, ColumnCount: 1 }, 1, 0).Html +'</div>';
                                        html += '</div></span>';
                                    }
                html += '<span class="accordion-text">' + menu0.DisplayName + '</span>\
                                </div>\
                            </div>\
                            <div id="collapse'+ menu0.Id + '" class="accordion-body collapse">\
                            <div class="accordion-inner row no-gutters">\
                                <div class="menu-accordion-left-box" style="text-align:center;">\
                                    <img class="menu-accordion-img" src="/cms/document/getimagemongo/'+ menu0.IconFileId + '" alt="Menu image" onerror=\'OnDocumentError(this);\'>';
                @if (_userContext.IsSystemAdmin) {
                  @:  html += '<a href="javascript:EditHelpContent(' + menu0.PageType + ',\'' + menu0.Id+'\');"  >Edit Content</a>';
                }
                html += '</div>\
                               <div class="menu-accordion-right-box">';
                if (menu0.MenuDetailSlides != null && menu0.MenuDetailSlides != undefined && menu0.MenuDetailSlides != '') {
                    var lis = '';
                    var divs = '';
                    var classActive = 'class="active"';
                    var active = 'active';
                    var slide = 0;
                    $.each(menu0.MenuDetailSlides, function (key, value) {
                        lis += '<li data-target="#slide' + menu0.Id + '" data-slide-to="' + slide + '" ' + classActive + '></li>';
                        divs += '<div class="carousel-item ' + active + '" style="width:100%;min-height:200px;">'+value.Details+'</div>';
                        slide++;
                        classActive = '';
                        active = '';
                    });
                    html += '<div id="slide' + menu0.Id +'" class="carousel slide menu-carousel" data-ride="carousel" data-interval="3000">\
                    <ul class="carousel-indicators">'+ lis + '</ul >\
                        <div class="carousel-inner">'+ divs +' </div>\
                    <a class="carousel-control-prev" href="#slide'+ menu0.Id + '" data-slide="prev">\
                        <span class="fa fas fa-2x fa-chevron-left"></span>\
                    </a>\
                    <a class="carousel-control-next" href="#slide'+ menu0.Id +'" data-slide="next">\
                          <span class="fa fas fa-2x fa-chevron-right"></span>\
                    </a>\
                    </div >';
                 }
                                html +='</div>\
                                </div>\
                                </div>\
                            </div>';
            }
            html += '</div>';
            $('#layout-am').html(html);
        }


    }
        function EditHelpContent(pageType, id) {
        var url = '@Url.Action("Index", "MenuGroupDetails", new { @area="Cms"})?Id=' + id;
        var title ='Manage Menu Group Help Content'
        if (pageType !== 15) {
            url = '@Url.Action("PageDetailsIndex", "Content", new { @area="Cms"})?Id='+id;
            title = 'Mange Page Help Content';
        }
         var win = GetMainWindow();
        win.iframeOpenUrl = url;
        win.OpenWindow({ Title: title, Width: 1200, Height: 650, cbm:"OnEditHelpContentCallback" });
        return false;
        }
        function OnEditHelpContentCallback() {
        }

    function SetBreadcrumb(data) {
            $('#bc').html('');
            $.each(data.bc, function (key, value) {
                AddBreadCrumb(value);
            });
        }
        function AddBreadCrumb(value, enablePrevious,previousBCName) {
            var html = '';

                if (value.IsNotClickable) {
                    if (value.IconCss === null || value.IconCss === '') {
                        html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span>' + value.Text + '</span></span>';
                    }
                    else {
                        html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span><i class="' + value.IconCss + ' pr-1"></i>' + value.Text + '</span></span>';
                    }
                }
                else {
                    if (value.Url === null || value.Url === '') {
                        if (value.IconCss === null || value.IconCss === '') {
                            html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span class="display" ' + (value.IsClickDisabled == true ? '' : 'style="display:none;"') + '>' + value.Text + '</span><span class="link" ' + (value.IsClickDisabled == false ? '' : 'style="display:none;"') + '><a href="javascript://void(0);" onclick="return OnBreadcrumbClick(null,\'' + value.PageId + '\',\'' + value.PageType + '\',\'' + value.RequestSource + '\',\'' + value.DataAction + '\',\'' + value.RecordId + '\')">' + value.Text + '</a></span></span>';
                        }
                        else {
                            html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span class="display" ' + (value.IsClickDisabled == true ? '' : 'style="display:none;"') + '><i class="' + value.IconCss + ' pr-1"></i>' + value.Text + '</span><span class="link" ' + (value.IsClickDisabled == false ? '' : 'style="display:none;"') + '><a href="javascript://void(0);" onclick="return OnBreadcrumbClick(null,\'' + value.PageId + '\',\'' + value.PageType + '\',\'' + value.RequestSource + '\',\'' + value.DataAction + '\',\'' + value.RecordId + '\')"><i class="' + value.IconCss + ' pr-1"></i>' + value.Text + '</a></span></span>';
                        }
                    }
                    else {
                        if (value.IconCss === null || value.IconCss === '') {
                            html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span class="display" ' + (value.IsClickDisabled == true ? '' : 'style="display:none;"') + '>' + value.Text + '</span><span class="link" ' + (value.IsClickDisabled == false ? '' : 'style="display:none;"') + '><a href="javascript://void(0);" onclick="return OnBreadcrumbClick(\'' + value.Url + '\')">' + value.Text + '</a></span></span>';
                        }
                        else {
                            html += '<span id="' + value.Name + '"><span class="pl-2 pr-2">/</span><span class="display" ' + (value.IsClickDisabled == true ? '' : 'style="display:none;"') + '><i class="' + value.IconCss + ' pr-1"></i>' + value.Text + '</span><span class="link" ' + (value.IsClickDisabled == false ? '' : 'style="display:none;"') + '><a href="javascript://void(0);" onclick="return OnBreadcrumbClick(\'' + value.Url + '\')"><i class="' + value.IconCss + ' pr-1"></i>' + value.Text + '</a></span></span>';
                        }
                    }
                }

            $('#bc').append(html);
            if (enablePrevious) {
                var display = $('#' + previousBCName).find('.display');
                var link = $('#' + previousBCName).find('.link');
                if (display !== null && display !== undefined) {
                    display.hide();
                    link.show();
                }
            }
        }
    function LoadCmsPartialView(url, pageType, popup, w, h, title, cbm, reload, container, iframe) {
        if (popup) {
                var win = GetMainWindow();
                win.iframeOpenUrl = url;
                win.OpenWindow({ Title: title, Width: w, Height: h, Reload: reload });
                return false;
            }
        if (iframe !== null && iframe !== undefined & iframe !== 'undefined') {
            iframe.src = url;
                return;
            }
            if (container === null || container === undefined || container==='undefined') {
                container = $('#cms-content');
            }
            container.html("");

            ShowLoader(container);
            $.ajax({
                url: url,
                type: 'GET',
                cache: false,
                success: function (data) {

                    if (data.msg !== null && data.msg !== undefined && data.msg !== '') {
                        ShowNotification(data.msg, 'success');
                    }
                    if (data.bc !== null && data.bc !== undefined && data.bc !== '') {
                        SetBreadcrumb(data);
                    }
                    if (data.am ===true) {
                        SetAccordianMenu(data.page);
                    }
                    if (data.login !== null && data.login !== undefined && data.login !== '') {
                        window.location.href = data.login;
                    }
                    else if (data.viewContent !== null && data.viewContent !== undefined && data.viewContent !== '') {
                        container.html(data.viewContent);
                    }
                    else if (pageType === 'Custom') {
                        LoadCustomFormIo(data, container);
                    }

                    else {
                        container.html(data.view);
                        var formio = document.getElementById('formio-container');
                        if (formio !== null) {
                            if (pageType === 'Page') {
                                LoadPageFormIo(data, formio);
                            }
                            else if (pageType === 'Form') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (pageType === 'Note') {
                                LoadFormFormIo(data, formio);
                            }
                            else if (pageType === 'Task') {
                                LoadTaskFormIo(data, formio);
                            }
                            else if (pageType === 'Service') {
                                LoadFormFormIo(data, formio);
                            }
                        }
                    }


                    HideLoader(container);
                    $("#divtooltip").empty();
                    $("#divtooltip").append('<span id="tooltip" class="key-button wider test"><i class="fad fa-question-circle" style="color: red; font-size: 20px;"></i></span>');
                    if (data.page.Description == "" || data.page.Description == null || data.page.Description == undefined) {
                        $("#tooltip").kendoTooltip({
                            content: "There is no helpful description for this page",
                            width: 400,
                        });
                    } else {
                        $("#tooltip").kendoTooltip({
                            content: data.page.Description,
                            width: 400,
                            autoHide: false,
                        });
                    }
                },
                error: function (errData) {
                    container.html(errData);
                    HideLoader(container);
                }
            });
        }

    function LoadPageById(id, pageType, source, dataAction, recordId, popup, w, h, title, cbm, reload, templatecodes, portalId, container, iframe,pageName) {
        @if (ViewBag.Portal!=null)
        {
            @:  $('#GlobalPortalId').val('@ViewBag.Portal.Id');
        }
            if (portalId === null || portalId === undefined) {
                  portalId = $('#GlobalPortalId').val();
                if (portalId === null || portalId === undefined) {
                    portalId = '';
                }
        }
        var lo = '@Convert.ToString(ViewBag.LayoutMode)';
        if (popup) {
            lo = 'Popup';
        }
        var url = '@Url.Action("Page", "Cms")?pageId=' + id + '&portalId=' + portalId + '&pageType=' + pageType + '&source=' + source + '&dataAction=' + dataAction + '&recordId=' + recordId + '&cbm=' + cbm + '&templatecodes=' + templatecodes + '&lo=' + lo + '&pageName=' + pageName +'&popup=@Convert.ToBoolean(ViewBag.IsPopup)';
        var refreshurl = "";
        @if (ViewBag.Portal!=null)
        {
            @: refreshurl = '/Portal/@ViewBag.Portal.Name?enc=' + EncryptParams('pageUrl=' + encodeURIComponent('pageId=' + id + '&portalId=' + portalId + '&pageType=' + pageType + '&source=' + source + '&dataAction=' + dataAction + '&recordId=' + recordId + '&cbm=' + cbm + '&templatecodes=' + templatecodes + '&lo=' + lo + '&pageName=' + pageName +'&popup=@Convert.ToBoolean(ViewBag.IsPopup)'));
        }
        if (!popup) {
            history.pushState({}, null, refreshurl);
        }
        else {
            url += "&popup=true&lo=Popup";
        }
        LoadCmsPartialView(url, pageType, popup, w, h, title, cbm, reload, container, iframe)
        return false;

        }
        function EncryptParams(prm) {
            var key = CryptoJS.enc.Utf8.parse('8080808080808080');
            var iv = CryptoJS.enc.Utf8.parse('8080808080808080');
            var ecp = CryptoJS.AES.encrypt(CryptoJS.enc.Utf8.parse(prm), key,
                {
                    keySize: 128 / 8,
                    iv: iv,
                    mode: CryptoJS.mode.CBC,
                    padding: CryptoJS.pad.Pkcs7
                });
            return ecp;
        }
        function LoadPartailView(url, container, type) {
            if (type === null || type === undefined || type === '') {
                type = 'GET';
            }
            ShowLoader(container);
            $.ajax({
                url: url,
                type: type,
                cache: false,
                success: function (data) {
                    console.log(data);
                    container.html("");
                    container.html(data);
                    HideLoader(container);
                },
                error: function (errData) {
                    container.html(errData);
                    HideLoader(container);
                }
            });
            return false;
    }
    function LoadPartailView1(url, loadcontainer, type) {
        var container = $('#' + loadcontainer);
        if (type === null || type === undefined || type === '') {
            type = 'GET';
        }
        ShowLoader(container);
        $.ajax({
            url: url,
            type: type,
            cache: false,
            success: function (data) {
                container.html("");
                container.html(data);
               // HideLoader(container);
            },
            error: function (errData) {
                container.html(errData);
                HideLoader(container);
            }
        });
    }
    function OpenChangePassowrd() {

         var win = GetMainWindow();
        win.iframeOpenUrl =  '@Url.Action("changepassword", "Account", new { @area = "" })';
        win.OpenWindow({ Title: 'Change Password', Width: 450, Height: 400 });
        return false;
    }
    function OpenMyProfile() {
            var myId = '@_userContext.UserId';
            console.log(myId);

          var win = GetMainWindow();
        win.iframeOpenUrl =  '@Url.Action("MyProfile", "User", new { @area = "" })?id=' + myId;
        win.OpenWindow({ Title: 'My Profile', Width: 450, Height: 500 });
        return false;
        }


    $(function () {

        var portals = [];
            @if (ViewBag.AllowedPortals!=null &&  ((List<CMS.UI.ViewModel.PortalViewModel>)ViewBag.AllowedPortals).Any()) {
                @: var portals = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AllowedPortals));
            }
            var le = [];
            @if (ViewBag.AllowedLegalEntities != null &&  ((List<CMS.UI.ViewModel.LegalEntityViewModel>)ViewBag.AllowedLegalEntities).Any()) {
                @: var le = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(ViewBag.AllowedLegalEntities));
            }
        var items = {
            "myProfile": { name: '@Html.Raw(SharedResource["MyProfile"])', icon: "fas fa-user" },
            "changePassword": { name: '@Html.Raw(SharedResource["ChangePassword"])', icon: "fas fa-key" },
            "sep1": "---------",
            "grantAccess": { name: '@Html.Raw(SharedResource["GrantAccess"])', icon: "fas fa-user" },
            "switchProfile": { name: '@Html.Raw(SharedResource["SwitchProfile"])', icon: "fas fa-user" },
            "sep2": "---------",
            "portal": { name: 'Portal',  icon: "fas fa-browser", items: {} },
            "legalEntity": { name: 'Legal Entity', icon: "fas fa-suitcase", items:{ }},
            "sep3": "---------",
            "logOut": { name: '@Html.Raw(SharedResource["Logout"])', icon: "fas fa-sign-out-alt" },


        };
        if (portals && portals.length > 0) {
            var portalItems = {};
            $.each(portals, function (key, item) {
                var name = 'Portal_' + item.Id;
                if (item.Id === '@viewBagPortalId') {

                    portalItems[name] = { name: item.Name + '<span class="pl-3 fas fa-check text-success"></span>', icon: "fas fa-browser",isHtmlName: true };
                }
                else {
                    portalItems[name] = { name: item.Name, icon: "fas fa-browser" };
                }

            });
            items['portal'].items = portalItems;
        }
        else {
            delete items['portal'];
        }
        if (le && le.length > 0) {
            var leItems = {};
            $.each(le, function (key, item) {
                var name = 'LE_' + item.Id;
                if (item.Id === '@_userContext.LegalEntityId') {
                    leItems[name] = { name: item.Name + '<span class="pl-3 fas fa-check text-success"></span>', icon: "fas fa-suitcase",isHtmlName: true };
                }
                else {
                    leItems[name] = { name: item.Name, icon: "fas fa-suitcase" };
                }
            });
           items['legalEntity'].items = leItems;
        }
        else {
            delete items['legalEntity'];
        }

        $.contextMenu({
            selector: '.user-context-menu',
            trigger: 'left',
            build: function ($trigger, e) {
               return {
                            callback: function (key, options) {
                                switch (key) {
                                    case 'myProfile':
                                        OpenMyProfile();
                                        break;
                                    case 'grantAccess':
                                        OpenGrantAccess();
                                        break;
                                    case 'switchProfile':
                                        SwitchProfile();
                                        break;
                                    case 'switchPortal':
                                        SwitchPortal();
                                        break;
                                    case 'changePassword':
                                        OpenChangePassowrd();
                                        break;
                                    case 'logOut':
                                        $('#logoutModal').modal('show');
                                        break;
                                    default:
                                        if (key.startsWith("Portal_")) {
                                            OnMenuPortalChange(key.replace('Portal_', ''));
                                        }
                                        else if (key.startsWith("LE_")) {
                                            OnMenuLegalChange(key.replace('LE_', ''));

                                        }
                                        break;
                                }

                            },
                            items: items
                        };


            }
        });
           });
        function ShowNotification(msg, type) {
            var popupNotification = $("#popupNotification").kendoNotification({
                position: {
                    pinned: true,
                    top: 100,
                    right: 30
                }
            }).data("kendoNotification");
            popupNotification.show(msg, type);
        }
    function OnSwitchProfileRefresh() {

        window.location.reload();
        return false;
        }
        function SwitchPortal() {
            var win = GetMainWindow();
            win.iframeOpenUrl = "/account/switchportal";
            win.OpenWindow({ Title: 'Switch Portal', Width: 450, Height: 600 });
            return false;
        }
        function OnSwitchPortalRefresh(portal) {
            window.location.href = '/portal/' + portal;
            return false;
        }
    function ConvertDate() {

         $('.form-parse-date :input[data-role="datetimepicker"]').each(function () {
            var id = this.id;
            var value = $("#" + id).data("kendoDateTimePicker").value();
            if (value!=null) {
                var formattedDate = kendo.toString(value, "@CMS.Common.ApplicationConstant.Database.JQueryDateFormat");
                $("#" + id).val(formattedDate);
            }
        });
         $('.form-parse-date :input[data-role="datepicker"]').each(function () {
            var id = this.id;
            var value = $("#" + id).data("kendoDatePicker").value();
            if (value!=null) {
                var formattedDate = kendo.toString(value, "@CMS.Common.ApplicationConstant.Database.JQueryDateFormat");
                $("#" + id).val(formattedDate);
            }
        });
    }
    function ResetDate()
    {
        $('.form-parse-date :input[data-role="datetimepicker"]').each(function () {
            var id = this.id;
            var value = $("#" + id).data("kendoDateTimePicker").value();

            if (value!=null) {
                var formattedDate = kendo.toString(value, "@CMS.Common.ApplicationConstant.DateAndTime.DefaultJqueryDateTimeFormat");
                $("#" + id).data("kendoDateTimePicker").value(formattedDate)
                $("#" + id).val(formattedDate);
            }
        });
        $('.form-parse-date :input[data-role="datepicker"]').each(function () {
            var id = this.id;
                var value = $("#" + id).data("kendoDatePicker").value();
            if (value!=null) {
                var formattedDate = kendo.toString(value, "@CMS.Common.ApplicationConstant.DateAndTime.DefaultJqueryDateTimeFormat");
                $("#" + id).data("kendoDatePicker").value(formattedDate);
                $("#" + id).val(formattedDate);
            }
        });
        }
          function ChangeLanguage(lng) {
            if (lng === '@_userContext.CultureName') {
                return false;
              }

              $('#hdnLang').val(lng);
              $('#languageModal').modal('show');
              return false;
    }
    function onAjaxSuccessChangeLanguage(res) {
        window.location.href = window.location.href;
        return false;
        }

    </script>


    <script type="text/x-kendo-tmpl" id="drp-user-template">
          <div class="row no-gutter pb-1 pt-1">
              <div class="col-2">
              #if(data.PhotoId!=null)
                  {#<img class="avatar-drp-profile" src="/user/profilephoto?id=#:data.PhotoId#"  /> #}
              else
                  {#<img class="avatar-drp-profile" style="background-color:gray;" src="/images/profile.jpg" />#}#
             </div>
             <div class="col-10">
                <div class="col-12">
                  <span style="padding:5px;">#:Name#</span></div>
                <div class="col-12">
                  #if (data.Email!=null)
                      {#<span style="padding:5px;font-size:12px;">#:Email#</span>  # } #
                </div>
             </div>
        </div>
    </script>
    <script type="text/x-kendo-tmpl" id="drp-user-value-template">
        <img class="avatar-myProfile" src="/user/profilephoto?id=#:data.PhotoId#"  />
        #if(data.PhotoId!=null){#
                <img class="avatar-myProfile" src="/user/profilephoto?id=#:data.PhotoId#" /> #}
                else{#
                <img class="avatar-myProfile" style="background-color:gray;" src="/images/profile.jpg" />#}#
                #if (data.Name!=null) {#
                <span style="margin-left:15px;">#:Name#</span> # } #
    </script>
    <ejs-scripts></ejs-scripts>

</body>

</html>