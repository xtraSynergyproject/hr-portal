@using Synergy.App.ViewModel;
@using Synergy.App.Common;
@*@using Kendo.Mvc.UI;*@
@model PayrollRunResultViewModel
@{
    ViewData["Title"] = "Payroll Run Result";
    //Layout = null;
    Layout = "~/Areas/Core/Views/Shared/_PopupLayout.cshtml";
}
<script>
    $(document).ready(function () {
        debugger;
        onManagePayrollBatch();

    });
    function OnEditDependant(e) {

        //e.preventDefault();
        //var dataItem = this.dataItem($(e.currentTarget).closest("tr"));

        //var portalId = $('#GlobalPortalId').val();

        //var url = '/Cms/Page?lo=Popup&cbm=AfterCreateDependent&source=Versioning&dataAction=Edit&pageName=Dependent&portalId=' + portalId + '&recordId=' + dataItem.id;

        //var win = GetMainWindow();
        //win.iframeOpenUrl = url;
        //win.OpenWindow({ Title: 'Manage Dependent', Width: 1200, Height: 600 });
        //return false;
    }

    function OnCreatePayrollBatch() {
        var url = '/Pay/PayrollBatch/ManagePayrollBatch';
        var win = GetMainWindow();
        win.iframeOpenUrl = url;
        win.OpenWindow({ Title: 'Create Payroll Batch', Width: 450, Height: 750, Position: 'Right' });
        //var url = "/pay/payrollrun/GetPayrollClosedCount";
        //$.ajax({
        //    url: url,
        //    type: 'GET',
        //    cache: false,
        //    async: false,
        //    success: function (data) {
        //
        //        if (data.success) {
        //            //alert(data);
        //            var url = '/Pay/PayrollBatch/ManagePayrollBatch';
        //            var win = GetMainWindow();
        //            win.iframeOpenUrl = url;
        //            win.OpenWindow({ Title: 'Create Payroll', Width: 450, Height: 750, Position: 'Right' });
        //        } else {
        //            kendo.alert("Please close all existing payroll before creating new payroll.");
        //        }
        //    }
        //});
        return false;

    }


    function AfterCreatePayrollBatch() {
        $("#kgrdPayrollBatch").data("kendoGrid").dataSource.read();
    }

    function onTabSelect(e) {
        SetTabControls($(e.item).index(), false);
    }
    function SetTabControls(index, select) {
        var tabStrip = $("#tabstripTemplate").data("kendoTabStrip");
        if (select) {
            tabStrip.select(index);
        }
    }

    function onManagePayrollBatch() {
        LoadPartailView('/Pay/PayrollRun/Manage?payrollId=@Model.PayrollId&id=@Model.PayrollRunId', $('#detailPage'));
    }

    function onPayrollRunResult() {
        LoadPartailView('/Pay/PayrollRunResult/PayrollResult?payrollRunId=@Model.PayrollRunId&payrollId=@Model.PayrollId', $('#detailPage'));
    }

    function onPayrollRunResult1() {
        LoadPartailView('/Pay/PayrollRun/Manage?payrollId=@Model.PayrollId&id=@Model.PayrollRunId', $('#detailPage'));
    }

</script>

<style>
    .fa-plus {
        margin-top: 5px;
    }
</style>

<div style="padding:15px;">
    <div class="row-12">
        @*@(Html.Kendo().TabStrip()
                         .Name("tabstripTemplate")
                         .Events(e => e.Select("onTabSelect"))
                         .Items(tabstrip =>
                         {
                             if (ViewBag.ResultOnly == false)
                             {
                                 tabstrip.Add().Text("Manage Payroll Batch").Selected(true)
                                 .LoadContentFrom(Url.Content(string.Concat("/Pay/PayrollRun/Manage?payrollId=", Model.PayrollId, "&id=", Model.PayrollRunId)));

                                 tabstrip.Add().Text("Payroll Run Result")
                                 .LoadContentFrom(Url.Content(string.Concat("/Pay/PayrollRunResult/PayrollResult?payrollRunId=", Model.PayrollRunId, "&payrollId=", Model.PayrollId)));

                             }
                             else
                             {
                                 tabstrip.Add().Text("Payroll Run Result").Selected(true)
                                 .LoadContentFrom(Url.Content(string.Concat("/Pay/PayrollRun/Manage?payrollId=", Model.PayrollId, "&id=", Model.PayrollRunId)));

                             }
                             // tabstrip.Add().Text("Payroll Daily Run Result").LoadContentFrom(Url.Content(string.Concat("~/Pay/PayrollRunResult/PayrollDailyRunResult?payrollRunId=", Model.PayrollRunId, "&payrollId=", Model.PayrollId)));

                             //tabstrip.Add().Text("Attendance").Content(@Html.Partial("~/Areas/Rpt/Views/taareport/_EmployeeAttendanceGrid.cshtml").ToHtmlString());
                             //tabstrip.Add().Text("End Of Service Accrual").Content(@Html.Partial("~/Areas/Rpt/Views/PayrollReport/_EosAccrualGrid.cshtml").ToHtmlString());
                             //tabstrip.Add().Text("Vacation Accrual").LoadContentFrom(Url.Content(string.Concat("~/Rpt/PayrollReport/VacationAccrualView?payrollId=", Model.PayrollId)));
                             //tabstrip.Add().Text("Flight Ticket Accrual").Content(@Html.Partial("~/Areas/Rpt/Views/PayrollReport/_FlightTicketAccrualGrid.cshtml").ToHtmlString());
                             //tabstrip.Add().Text("Loan Accrual").Content(@Html.Partial("~/Areas/Rpt/Views/PayrollReport/_LoanAccrualGrid.cshtml").ToHtmlString());

                         }

            ))*@
        @Html.HiddenFor(x => x.PayrollRunId)
        @Html.HiddenFor(x => x.YearMonth)
        @Html.HiddenFor(x => x.Year)
        @Html.HiddenFor(x => x.Month)
        @Html.HiddenFor(x => x.PayrollId)
    </div>
</div>

<div class="row pad-10 no-gutters page-content">
    <div class="container" style="padding:0px;max-width:100%">
        <ul class="nav nav-tabs" role="tablist" id="myTabs">
            @if (ViewBag.ResultOnly == false)
            {
                <li class="nav-item"><a data-toggle="tab" href="#detailPage" class="nav-link active" role="tab" aria-controls="detailPage" aria-selected="true" onclick="onManagePayrollBatch()"><i class="far fa-file-alt" style="margin-left:15px;"></i><br />MANAGE PAYROLL BATCH</a></li>
                <li class="nav-item"><a data-toggle="tab" href="#detailPage" class="nav-link" aria-controls="detailPage" aria-selected="false" onclick="onPayrollRunResult()"><i class="fab fa-css3" style="margin-left:3px;"></i><br />PAYROLL RUN RESULT</a></li>
            }
            else
            {
                <li class="nav-item"><a data-toggle="tab" href="#detailPage" class="nav-link" aria-controls="detailPage" aria-selected="true" onclick="onPayrollRunResult1()"><i class="fab fa-css3" style="margin-left:3px;"></i><br />PAYROLL RUN RESULT</a></li>
            }

        </ul>
        <div class="tab-content" style="border: 1px solid silver;border-top:none;">
            <div id="detailPage" class="tab-pane in active" role="tabpanel" aria-labelledby="pageCss-tab">
            </div>
        </div>
    </div>
</div>
