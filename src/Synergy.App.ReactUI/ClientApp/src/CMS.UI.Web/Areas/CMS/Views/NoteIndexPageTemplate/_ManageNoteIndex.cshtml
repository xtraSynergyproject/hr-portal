@using Synergy.App.ViewModel;
@using Synergy.App.Common;

@{
    ViewData["Title"] = "Portal";
    Layout = null;
    //Layout = "/Views/Shared/_PopupLayout.cshtml";
    //Layout = "/Areas/Cms/Views/Shared/_LayoutCms.cshtml";
}
@inject Synergy.App.Common.IUserContext _userContext
@model NoteIndexPageTemplateViewModel

<style>
    .form-label-group {
        position: relative;
        margin-bottom: 0px;
    }
    .cms-manageportal-footer {
        /*        position: absolute;*/
        left: 0;
        bottom: 0;
        padding: 10px;
        padding-right: 20px;
        width: 100%;
        background-color: #F8F8F8 !important;
        color: white;
        text-align: right;
    }

    .slidenav-flow {
        overflow-x: hidden;
        overflow-y: auto !important;
        height: 75%;
    }

    .style-mylogoimage {
        /*border-radius: 50%;*/
        height: 100px;
        width: 100px;
    }

    .style-mybannerimage {
        /*border-radius: 50%;*/
        height: 100px;
        width: 100px;
    }

    .style-image {
        width: 30%;
        float: left;
    }

    .style-upload {
        width: 70%;
        float: left;
    }

    .style-pickerleft {
        width: 50%;
        float: left;
        padding-bottom: 15px;
    }
    /*    k-colorpicker {
        width: 100px;
    }

    .k-colorpicker .k-selected-color {
            width: 100px;
    }*/

</style>
<script type="text/javascript">
    function DataBound(e) {
        
        $(".selectcheckbox").bind("click", function (e) {
            e.stopPropagation();
            $(e.target).closest("tr").toggleClass("k-state-selected");
        });

        var rows = e.sender.element.find("tr");
        rows.each(function (e) {
            $(this).children().first().on("click", onFirstTDClick);
        })
        var abc = "@ViewBag.RowData";
        var arr = JSON.parse(abc.replace(/&quot;/g, '"'));

            for (var i = 0; i < arr.length; i++)
            {
                console.log(e.sender._data[0].Id);
                //if (e.sender._data[0].Id == arr[i].Id)
                //{
                    $("#selectcheckbox_"+ arr[i].Id).closest("tr").toggleClass("k-state-selected");
                    document.getElementById('selectcheckbox_' + arr[i].Id + '/').closest('tr').classList.add("k-state-selected");
                    document.getElementById('selectcheckbox_' + arr[i].Id + '/').checked = true;


                //}
            }

    }
    function onFirstTDClick(e) {
        e.stopPropagation();
        var tr = $(e.target).closest("tr");
        tr.find('[type=checkbox]').prop('checked', !tr.hasClass("k-state-selected"));
        tr.toggleClass("k-state-selected");

    }

    function ongridChange(arg) {
        
        var selectedRows = this.select();
        this.editRow(this.select());


        $('tr').find('[type=checkbox]').prop('checked', false);
        $('tr.k-state-selected').find('[type=checkbox]').prop('checked', true);

        var selectedRows = this.select();
        var selectedDataItems = [];
        for (var i = 0; i < selectedRows.length; i++) {
            var dataItem = this.dataItem(selectedRows[i]);
            selectedDataItems.push(dataItem);
        }
        selectedRows = selectedDataItems;
    }
    function SaveData(e) {
        
        var selectedRows = [];
        var entityGrid = $("#grid").data("kendoGrid");
        var rows = entityGrid.select();
        rows.each(function (index, row) {
            var selectedItem = entityGrid.dataItem(row);
            selectedRows.push(selectedItem);
        });
        console.log(selectedRows);
        $("#RowData").val(JSON.stringify(selectedRows));
        if (selectedRows.length==0)
        {
            $(".text-danger").removeClass("validation-summary-valid");
            $(".text-danger").addClass("validation-summary-errors");
            $(".text-danger").html("select at leaset one column");
            e.preventDefault();
            return false;
        }
    }

    function OnCancel(args) {

    }
    $(document).ready(function () {
        //alert($('#EnableDeletebtn').val());
        $('#EnableDeletebtn').change(function () {
            
            if (this.checked) {

                $('#confirmationdel').show();
            }
            else {
                $('#confirmationdel').hide();
            }

        });
        if ($('#EnableDeletebtn').val() == 'true')
        {
            $('#confirmationdel').show();
        }
    });

    function closeNavPortal() {
        var win = GetMainWindow();
        win.CloseWindow();
        return false;

    }



    var onAjaxSuccess = function (res) {
        if (res.success) {
            if ('@Model.DataAction'=='@DataActionEnum.Create')
            {
                ShowNotification("Saved Successfully", "success");
            }
            if ('@Model.DataAction'=='@DataActionEnum.Edit')
            {
                ShowNotification("Updated Successfully", "success");
            }
           // window.parent.parent.$("#documentTypeTreeView").data("kendoTreeView").dataSource.read();
            var TemplateId = res.templateId;
            LoadPartailView('@Url.Action("ManageIndex", "Template", new { @area = "Cms"})?templateId=' + TemplateId, $('#index'));
        }
        else {
            alert(res)
            showError(res.error);
        }
    };



</script>
<div style="margin-top: 5px;padding-left: 20px;padding-right: 20px;width: 100%;">

    <form asp-controller="NoteIndexPageTemplate" asp-action="ManageNoteTempltaeIndexPageData" class="form-horizontal"
          data-ajax-begin="onAjaxBegin" data-ajax-complete="onAjaxComplete"
          data-ajax-failure="onAjaxFailed" data-ajax-success="onAjaxSuccess"
          data-ajax="true" data-ajax-method="POST">
        @Html.HiddenFor(x => x.RowData)
        @Html.HiddenFor(x => x.TemplateId)
        @Html.HiddenFor(x => x.Id)
        @Html.HiddenFor(x => x.DataAction)
        @Html.HiddenFor(x => x.IndexPageTemplateType)
        @Html.HiddenFor(x => x.ParentReferenceId)

        <div id="validation-summary" class="text-danger" asp-validation-summary="All"></div>

        <div class="row no-gutters pad-10">
            <div class="col-2">
                <label for="MenuName">Rendering Type</label>
            </div>
            <div class="col-9">
                @*@(Html.Kendo().DropDownListFor(x => x.IndexRenderingType)
                                   .DataSource(source =>
                                   {
                                       source.Read(read =>
                                       {
                                           read.Action("GetEnumIdNameList", "Home", new { @area = "", enumType = "IndexRenderingTypeEnum" });
                                       });
                                   })
                        .DataTextField("Name")
                        .DataValueField("Id")
                                  .HtmlAttributes(new { @class = "hr-x-large" })
               )*@

            </div>
        </div>

        <div class="row no-gutters pad-10">
            <div class="col-3">
                <input asp-for="EnableCreateButton" type="checkbox" class="k-checkbox" style="margin-right:5px;" />
                <label>Enable Create Button</label>
            </div>
            <div class="col-3" style="margin-right:5px;">
                <div class="form-label-group">
                    <input asp-for="CreateButtonText" type="text" placeholder="Create Button Text" class="form-control" />
                    <label for="CreateButtonText">Create Button Text</label>
                </div>

            </div>
            <div class="col-3">
                <div class="form-label-group">
                    <input asp-for="CreateButtonCss" type="text" placeholder="Create Button Css" class="form-control" />
                    <label for="CreateButtonCss">Create Button Css</label>
                </div>

            </div>
            @*<div class="col-3" style="margin-right:5px;">
            <input asp-for="CreateButtonText" type="text" placeholder="Create Button Text" class="form-control" />
        </div>
        <div class="col-3" style="margin-right:5px;">
            <input asp-for="CreateButtonCss" type="text" placeholder="Create Button Css" class="form-control" />
        </div>*@

            @*<div class="col-3">

                    @(Html.Kendo().DropDownListFor(x=>x.CreateStyle)
           // .Name("Style")
              .DataTextField("Text")
              .DataValueField("Value")
              .BindTo(new List<SelectListItem>() {
                  new SelectListItem() {
                      Text = "Popup-Centre",
                      Value = "1"
                  },
                  new SelectListItem() {
                      Text = "Popup-left",
                      Value = "2"
                  },
                     new SelectListItem() {
                      Text = "Popup-right",
                      Value = "3"
                  },
                       new SelectListItem() {
                      Text = "New Page",
                      Value = "4"
                  },

              })
              .Value("1")
             // .HtmlAttributes(new { style = "width: 100%" })
        )
                </div>*@


        </div>
        <div class="row no-gutters pad-10">
            <div class="col-3">
                <input asp-for="EnableEditButton" type="checkbox" class="k-checkbox" style="margin-right:5px;" />
                <label>Enable Edit Button</label>
            </div>
            <div class="col-3" style="margin-right:5px;">
                <div class="form-label-group">
                    <input asp-for="EditButtonText" type="text" placeholder="Edit Button Text" class="form-control" />
                    <label for="EditButtonText">Edit Button Text</label>
                </div>

            </div>
            <div class="col-3">
                <div class="form-label-group">
                    <input asp-for="EditButtonCss" type="text" placeholder="Edit Button Css" class="form-control" />
                    <label for="EditButtonCss">Edit Button Css</label>
                </div>

            </div>
            @*<div class="col-3" style="margin-right:5px;">
            <input asp-for="EditButtonText" type="text" placeholder="Edit Button Text" class="form-control" />
        </div>
        <div class="col-3">
            <input asp-for="EditButtonCss" type="text" placeholder="Edit Button Css" class="form-control" />
        </div>*@
        </div>



        <div class="row no-gutters pad-10">
            <div class="col-3">
                <input asp-for="EnableDeleteButton" type="checkbox" id="EnableDeletebtn" class="k-checkbox" style="margin-right:5px;" />
                <label>Enable Delete Button</label>
            </div>
            <div class="col-3" style="margin-right:5px;">
                <div class="form-label-group">
                    <input asp-for="DeleteButtonText" type="text" placeholder="Delete Button Text" class="form-control" />
                    <label for="DeleteButtonText">Delete Button Text</label>
                </div>

            </div>
            <div class="col-3">
                <div class="form-label-group">
                    <input asp-for="DeleteButtonCss" type="text" placeholder="Delete Button Css" class="form-control" />
                    <label for="DeleteButtonCss">Delete Button Css</label>
                </div>

            </div>
            @*<div class="col-3" style="margin-right:5px;">
            <input asp-for="DeleteButtonText" type="text" placeholder="Delete Button Text" class="form-control" />
        </div>
        <div class="col-3">

            <input asp-for="DeleteButtonCss" type="text" placeholder="Delete Button Css" class="form-control" />
        </div>*@

        </div>
        <div class="row no-gutters pad-10" id="confirmationdel" style="display:none;">
            <div class="col-3 ">
                <input asp-for="EnableDeleteConfirmation" type="checkbox" class="k-checkbox" style="margin-right:5px;" />
                <label>Enable Delete Confirmation</label>
            </div>
            <div class="col-9">
                <div class="form-label-group">
                    <input asp-for="DeleteConfirmationMessage" type="text" placeholder="Delete Confirmation Message" class="form-control" />
                    <label for="DeleteConfirmationMessage">Delete Confirmation Message</label>
                </div>

            </div>
            @*<div class="col-9">
            <input asp-for="DeleteConfirmationMessage" type="text" placeholder="Delete Confirmation Message" class="form-control" />
        </div>*@

        </div>
        <div class="row pad-10">
            @*@(Html.Kendo().Grid<NoteIndexPageColumnViewModel>
    ()
    .Name("grid")
    .Columns(columns =>
    {
        columns.Template("<input class='selectcheckbox' type='checkbox' id=selectcheckbox_#:Id#/>").Title("Select").Width(50);
        // columns.Select().Width(50);
        columns.Bound(p => p.ColumnName).Width(120);
        columns.Bound(p => p.HeaderName).Width(120);
        columns.Bound(p => p.EnableSorting).Width(120);
        columns.Bound(p => p.EnableFiltering).Width(120);
        columns.Bound(p => p.SequenceOrder).Width(120);
        columns.Bound(p => p.AdvanceSetting).Width(120);
    })
    .Editable(editable => editable.Mode(GridEditMode.InCell))
    .Pageable()
    .Sortable()
    .Scrollable()
    //.Selectable(x=>x.Mode(GridSelectionMode.Multiple).Type(GridSelectionType.Row))
     .Events(ev => ev.Change("ongridChange")
     .DataBound("DataBound")
    )
    .HtmlAttributes(new { style = "height:550px;" })
    .DataSource(dataSource => dataSource
    .Ajax()
     .Batch(true)
    .Read(read => read.Action("ReadTableProperties", "Template",new { @templateId = Model.TemplateId, @indexPageTemplateId=Model.Id}))
     .Model(model =>
     {
         model.Id(p => p.Id);
         model.Field(p => p.Id).Editable(false);
         model.Field(p => p.ColumnName).Editable(false);
         model.Field(p => p.AdvanceSetting).Editable(false);
     })
    .PageSize(20)

    )

    )*@
        </div>
        <div class="cms-footer">
            <div class="col-sm-12" style="text-align:right;">
                <input type="submit" class="btn btn-success" onclick="SaveData(event)" value="Save" />

            </div>
            @*<input type="button" class="btn btn-link" value="Save and Preview" onclick="OnSave('Preview')" />
            <input type="button" class="btn btn-success" value="Save and Publish" onclick="OnSave('Publish')" />
            <input type="button" class="btn btn-primary" value="Save" onclick="OnSave()" />*@
        </div>
    </form>
    
</div>

