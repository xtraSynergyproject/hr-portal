
@using Synergy.App.ViewModel;
@using Kendo.Mvc.UI;
@using Synergy.App.Common;
@using Kendo.Mvc.Extensions;
@model UserHierarchyPermissionViewModel;
@{

    Layout = "/Views/Shared/_PopupLayout.cshtml";

}
<style>
    .kgrdPDMS {
        width: 100% !important;
        padding:10px;
    }
</style>
<script type="text/javascript">
    $(function () {
    //$(document).ready(function () {
        

        getBusinessHierarchyRootPermission();
        $.contextMenu({
            selector: '#tree-menuBin',
            trigger: 'left',
            build: function ($trigger, e) {


                var id = $trigger.data('idvalue');
                var UserId = $trigger.data('userid');

                //var portalName = $trigger.data('portal-name');

                switch (0) {
                    case 0:
                        return {
                            callback: function (key, options) {
                                switch (key) {
                                    case 'edit':
                                        OnEditBHRP(id,UserId);
                                        break;
                                    case 'del':
                                        OnDeleteBHRP(id);
                                        break;
                                   
                                    default:
                                }
                            },
                            items: {
                                "edit": { name: "Edit", icon: "fas fa-pencil" },
                                "del": { name: "Delete", icon: "fas fa-trash" },
                               }
                        };


                }
            }
        });


   

    });

    var columnDefs = [
        {
            headerName: "Actions",
            field: "Id",
            cellRenderer: params => {
                return "<div class='btn-group grid-menu' id='tree-menuBin' data-idvalue='" + params.value + "' data-userid='" + params.data.UserId + "' ><i class='fas fa-ellipsis-v'></i></div>"
            }
        },

        {
         headerName: "User Name",
         field: "UserName",
        },
        {
            headerName: "Reference Name",
            field: "Name",
        },
     {
         headerName: "Reference Type",
         field: "ReferenceType",
     }
    

    ];


    function getBusinessHierarchyRootPermission() {
        
        document.getElementById("kgrdGrid").innerHTML = "";

        gridConfig(
            "kgrdGrid",
            "/CHR/BusinessHierarchy/GetBusinessHierarchyRootPermission",
            columnDefs,
            false,
            true,
            true,
            true,
            1,
            true,
            10);
    }

</script>



<div class="row" style="padding:10px;margin:20px;">
    <h4>Business Hierarchy Root Permission</h4>

    <hr />
    <button type='button' class='btn btn-primary' onclick='OnCreateBHRP();'><i class='fa fas fa-plus'></i>&nbsp;Create</button>
    <br/>
    <div id="kgrdGrid" style="width: 100%;height:550px" class="ag-theme-alpine"></div>
</div>
<script>
    function OnEditBHRP(id, UserId) {
        
         @*UserId='@Model.UserId';*@
        var win = GetMainWindow();
        win.iframeOpenUrl =  '@Url.Action("ManageBusinessHierarchyRootPermission", "BusinessHierarchy", new { @area= "CHR" })?Id=' + id + '&UserId='+ UserId;
        win.OpenWindow({ Title: 'Edit', Width: 500, Height: 650 });
        return false;
    }

    function OnDeleteBHRP(id) {
        var flag = confirm('Do you really want to delete?');

        if (flag) {
            $.ajax({
                url:'@Url.Action("DeleteUserHierarchyPermission", "BusinessHierarchy", new { @area= "CHR" })?Id=' + id,
                type: 'POST',
                data: {},
                dataType: 'json',
                success: function (result) {
                    
                    if (result.success) {
                        getBusinessHierarchyRootPermission();
                        kendo.alert("Deleted Successfully.");
                    } else {
                        getBusinessHierarchyRootPermission();
                        var err = result.errors.BinderCountError.errors[0];
                        kendo.alert(err);
                    }
                },
                error: function (ert) {
                    getBusinessHierarchyRootPermission();
                }
            });
            return false;
        }
    }
      function OnCreateBHRP() {

           var win = GetMainWindow();
        win.iframeOpenUrl = '@Url.Action("ManageBusinessHierarchyRootPermission", "BusinessHierarchy", new { @area= "CHR" })';
        win.OpenWindow({ Title: 'Create', Width: 500, Height: 650 });
        return false;
    }
</script>

